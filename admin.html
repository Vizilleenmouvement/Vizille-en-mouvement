<!DOCTYPE html>
<html lang="fr">
<head>
    <script>
        // Protection par mot de passe - @@@@
        (function() {
            const PASSWORD = '@@@@';
            const MAX_ATTEMPTS = 3;
            
            if (!sessionStorage.getItem('vizille_auth')) {
                let attempts = 0;
                let authenticated = false;
                
                while (!authenticated && attempts < MAX_ATTEMPTS) {
                    const input = prompt('Mot de passe requis pour accÃ©der au site :');
                    
                    if (input === null) {
                        window.location.href = 'about:blank';
                        break;
                    }
                    
                    if (input === PASSWORD) {
                        authenticated = true;
                        sessionStorage.setItem('vizille_auth', 'true');
                    } else {
                        attempts++;
                        if (attempts < MAX_ATTEMPTS) {
                            alert('Mot de passe incorrect. Tentative ' + attempts + '/' + MAX_ATTEMPTS);
                        } else {
                            alert('Trop de tentatives. AccÃ¨s refusÃ©.');
                            window.location.href = 'about:blank';
                        }
                    }
                }
                
                if (!authenticated) {
                    document.body.innerHTML = '';
                }
            }
        })();
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administration - Vizille en Mouvement</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bleu: #1a3a5c;
            --bleu-clair: #2d5a87;
            --or: #c9a227;
            --vert: #27ae60;
            --orange: #f39c12;
            --rouge: #e74c3c;
            --gris-bg: #f5f7fa;
            --gris-border: #e1e5eb;
            --gris-texte: #4a5568;
            --blanc: #ffffff;
            --shadow: 0 2px 8px rgba(0,0,0,0.1);
            --radius: 12px;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--gris-bg);
            color: var(--gris-texte);
            line-height: 1.6;
        }
        
        /* ===== LOGIN ===== */
        .login-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(135deg, var(--bleu) 0%, var(--bleu-clair) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }
        
        .login-overlay.hidden { display: none; }
        
        .login-box {
            background: white;
            padding: 3rem;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 400px;
            width: 90%;
        }
        
        .login-box h2 {
            color: var(--bleu);
            margin-bottom: 0.5rem;
            font-size: 1.8rem;
        }
        
        .login-box > p {
            color: var(--or);
            margin-bottom: 2rem;
            font-weight: 500;
        }
        
        .login-box input {
            width: 100%;
            padding: 1rem;
            border: 2px solid var(--gris-border);
            border-radius: 10px;
            font-size: 1.1rem;
            margin-bottom: 1rem;
            text-align: center;
        }
        
        .login-box input:focus {
            outline: none;
            border-color: var(--bleu);
        }
        
        .login-box button {
            width: 100%;
            padding: 1rem;
            background: var(--bleu);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .login-box button:hover {
            background: var(--bleu-clair);
            transform: translateY(-2px);
        }
        
        .login-error {
            color: var(--rouge);
            margin-top: 1rem;
            font-weight: 500;
        }
        
        /* ===== THEME BUTTONS ===== */
        .theme-btn {
            padding: 0.5rem 1rem;
            border: 2px solid var(--gris-border);
            background: white;
            border-radius: 25px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
        }
        
        .theme-btn:hover {
            border-color: var(--bleu);
            background: var(--gris-bg);
        }
        
        .theme-btn.active {
            background: var(--bleu);
            color: white;
            border-color: var(--bleu);
        }
        
        /* ===== HEADER ===== */
        .header {
            background: linear-gradient(135deg, var(--bleu) 0%, var(--bleu-clair) 100%);
            color: white;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow);
        }
        
        .header h1 { font-size: 1.3rem; font-weight: 600; }
        
        .header-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }
        
        .token-input {
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 0.9rem;
            width: 200px;
        }
        
        .token-input::placeholder { color: rgba(255,255,255,0.5); }
        
        /* ===== NAVIGATION ===== */
        .nav-tabs {
            background: var(--blanc);
            border-bottom: 1px solid var(--gris-border);
            display: flex;
            padding: 0 1rem;
            overflow-x: auto;
        }
        
        .nav-tab {
            padding: 1rem 1.25rem;
            border: none;
            background: none;
            font-size: 0.95rem;
            font-weight: 500;
            color: var(--gris-texte);
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
            white-space: nowrap;
        }
        
        .nav-tab:hover { color: var(--bleu); background: var(--gris-bg); }
        .nav-tab.active { color: var(--bleu); border-bottom-color: var(--or); }
        
        /* ===== MAIN ===== */
        main { padding: 1.5rem; max-width: 1400px; margin: 0 auto; }
        
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        
        /* ===== CARD ===== */
        .card {
            background: var(--blanc);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            margin-bottom: 1.5rem;
        }
        
        .card-header {
            background: linear-gradient(135deg, var(--bleu) 0%, var(--bleu-clair) 100%);
            color: white;
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .card-header h2 { font-size: 1.1rem; font-weight: 600; }
        
        .publish-bar {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .status {
            font-size: 0.85rem;
            padding: 0.3rem 0.75rem;
            border-radius: 20px;
            background: rgba(255,255,255,0.2);
        }
        
        .status.modified { background: var(--orange); }
        .status.saved { background: var(--vert); }
        .status.loading { background: rgba(255,255,255,0.3); }
        
        .btn-publish {
            background: var(--vert);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.2s;
        }
        
        .btn-publish:hover { background: #219a52; transform: translateY(-1px); }
        .btn-publish:disabled { background: #95a5a6; cursor: not-allowed; transform: none; }
        
        .card-body { padding: 1.5rem; }
        
        /* ===== FORMS ===== */
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .form-group { margin-bottom: 1rem; }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--bleu);
            font-size: 0.9rem;
        }
        
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid var(--gris-border);
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.2s;
            font-family: inherit;
        }
        
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: var(--bleu);
        }
        
        /* ===== PHOTO UPLOAD ===== */
        .photo-upload {
            border: 2px dashed var(--gris-border);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            background: var(--gris-bg);
        }
        
        .photo-upload:hover {
            border-color: var(--bleu);
            background: #eef2f7;
        }
        
        .photo-upload.dragover {
            border-color: var(--vert);
            background: #e8f5e9;
        }
        
        .photo-upload input { display: none; }
        
        .photo-upload .icon { font-size: 2.5rem; margin-bottom: 0.5rem; }
        
        .photo-upload p { color: var(--gris-texte); font-size: 0.9rem; }
        
        .photo-preview {
            margin-top: 1rem;
            display: none;
        }
        
        .photo-preview img {
            max-width: 150px;
            max-height: 150px;
            border-radius: 8px;
            object-fit: cover;
            border: 3px solid var(--vert);
        }
        
        .photo-preview.active { display: block; }
        
        /* ===== BUTTONS ===== */
        .btn {
            padding: 0.6rem 1.2rem;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
        }
        
        .btn-primary { background: var(--bleu); color: white; }
        .btn-primary:hover { background: var(--bleu-clair); }
        .btn-success { background: var(--vert); color: white; }
        .btn-danger { background: var(--rouge); color: white; }
        .btn-outline { background: transparent; border: 2px solid var(--gris-border); color: var(--gris-texte); }
        .btn-sm { padding: 0.4rem 0.8rem; font-size: 0.85rem; }
        
        /* ===== ITEMS LIST ===== */
        .items-list { margin-top: 1.5rem; }
        
        .items-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.75rem;
            border-bottom: 2px solid var(--gris-border);
        }
        
        .items-header h3 { color: var(--bleu); font-size: 1.1rem; }
        
        .item-card {
            background: var(--gris-bg);
            border-radius: 10px;
            padding: 1rem 1.25rem;
            margin-bottom: 0.75rem;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 1rem;
        }
        
        .item-card:hover { background: #eef1f5; }
        
        .item-info { flex: 1; display: flex; gap: 1rem; align-items: flex-start; }
        
        .item-photo {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
            background: var(--gris-border);
            flex-shrink: 0;
        }
        
        .item-photo-placeholder {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--gris-border);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            flex-shrink: 0;
        }
        
        .item-text { flex: 1; }
        
        .item-badge {
            display: inline-block;
            font-size: 0.75rem;
            background: #dbeafe;
            color: var(--bleu);
            padding: 0.2rem 0.6rem;
            border-radius: 4px;
            margin-bottom: 0.25rem;
        }
        
        .item-title {
            font-weight: 600;
            color: var(--bleu);
            margin-bottom: 0.25rem;
        }
        
        .item-desc {
            font-size: 0.9rem;
            color: var(--gris-texte);
        }
        
        .item-actions { display: flex; gap: 0.5rem; }
        
        /* ===== TOAST ===== */
        .toast {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            padding: 1rem 1.5rem;
            border-radius: 10px;
            color: white;
            font-weight: 500;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s;
            z-index: 1000;
        }
        
        .toast.show { transform: translateY(0); opacity: 1; }
        .toast.success { background: var(--vert); }
        .toast.error { background: var(--rouge); }
        .toast.warning { background: var(--orange); }
        .toast.info { background: var(--bleu); }
        
        /* ===== MODAL ===== */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 200;
            padding: 1rem;
        }
        
        .modal-overlay.active { display: flex; }
        
        .modal {
            background: white;
            border-radius: var(--radius);
            width: 100%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid var(--gris-border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h3 { color: var(--bleu); }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gris-texte);
        }
        
        .modal-body { padding: 1.5rem; }
        
        .modal-footer {
            padding: 1rem 1.5rem;
            border-top: 1px solid var(--gris-border);
            display: flex;
            justify-content: flex-end;
            gap: 0.75rem;
        }
        
        /* ===== EMPTY STATE ===== */
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--gris-texte);
        }
        
        .empty-state .icon { font-size: 3rem; margin-bottom: 1rem; }
        
        /* ===== RESPONSIVE ===== */
        @media (max-width: 768px) {
            .header { flex-direction: column; gap: 1rem; text-align: center; }
            .header-actions { width: 100%; justify-content: center; flex-wrap: wrap; }
            .card-header { flex-direction: column; gap: 1rem; }
            .publish-bar { width: 100%; justify-content: space-between; }
            .form-row { grid-template-columns: 1fr; }
            .item-info { flex-direction: column; }
        }
    </style>
</head>
<body>

    <!-- HEADER -->
    <header class="header">
        <h1>âš™ï¸ Administration - Vizille en Mouvement</h1>
        <div class="header-actions">
            <input type="password" class="token-input" id="github-token" placeholder="ğŸ” Token GitHub" onchange="saveToken()">
            <button class="btn btn-sm" style="background: rgba(255,255,255,0.2);" onclick="toggleToken()">ğŸ‘ï¸</button>
            <a href="https://Vizilleenmouvement.github.io/Vizille-en-mouvement/" target="_blank" class="btn btn-sm" style="background: var(--or); color: var(--bleu);">ğŸŒ Voir le site</a>
        </div>
    </header>

    <!-- NAVIGATION -->
    <nav class="nav-tabs">
        <button class="nav-tab active" data-tab="accueil">ğŸ  Accueil</button>
        <button class="nav-tab" data-tab="projets">ğŸš€ Projets</button>
        <button class="nav-tab" data-tab="themes">ğŸ¨ ThÃ¨mes</button>
        <button class="nav-tab" data-tab="actions">ğŸ“Š Actions</button>
        <button class="nav-tab" data-tab="candidats">ğŸ‘¥ Candidats</button>
        <button class="nav-tab" data-tab="faq">ğŸ¤ Construisons ensemble</button>
        <button class="nav-tab" data-tab="articles">ğŸ“° Articles</button>
        <button class="nav-tab" data-tab="communication">ğŸ“¢ Communication</button>
        <button class="nav-tab" data-tab="config">âš™ï¸ ParamÃ¨tres</button>
    </nav>

    <!-- MAIN -->
    <main>
        
        <!-- TAB: ACCUEIL -->
        <section class="tab-content active" id="tab-accueil">
            <div class="card">
                <div class="card-header" style="background: linear-gradient(135deg, #1a3a5c 0%, #c9a227 100%);">
                    <h2>ğŸ  Bienvenue dans l'Administration</h2>
                </div>
                <div class="card-body">
                    <div style="text-align: center; margin-bottom: 2rem;">
                        <h1 style="color: var(--bleu); font-size: 2rem; margin-bottom: 0.5rem;">Vizille en Mouvement</h1>
                        <p style="color: var(--or); font-size: 1.2rem;">Interface de gestion du site de campagne</p>
                    </div>

                    <!-- Ã‰TAPES -->
                    <div style="background: #e8f4fc; border-radius: 12px; padding: 1.5rem; margin-bottom: 2rem;">
                        <h3 style="color: var(--bleu); margin-bottom: 1rem;">ğŸš€ Comment Ã§a marche ?</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                            <div style="background: white; padding: 1rem; border-radius: 8px; text-align: center;">
                                <div style="font-size: 2rem; margin-bottom: 0.5rem;">1ï¸âƒ£</div>
                                <strong style="color: var(--bleu);">Configurer le token</strong>
                                <p style="font-size: 0.9rem; color: var(--gris-texte);">Collez le token GitHub en haut de page (une seule fois)</p>
                            </div>
                            <div style="background: white; padding: 1rem; border-radius: 8px; text-align: center;">
                                <div style="font-size: 2rem; margin-bottom: 0.5rem;">2ï¸âƒ£</div>
                                <strong style="color: var(--bleu);">Modifier le contenu</strong>
                                <p style="font-size: 0.9rem; color: var(--gris-texte);">Ajoutez, modifiez ou supprimez des Ã©lÃ©ments</p>
                            </div>
                            <div style="background: white; padding: 1rem; border-radius: 8px; text-align: center;">
                                <div style="font-size: 2rem; margin-bottom: 0.5rem;">3ï¸âƒ£</div>
                                <strong style="color: var(--bleu);">Publier</strong>
                                <p style="font-size: 0.9rem; color: var(--gris-texte);">Cliquez sur ğŸš€ Publier dans l'onglet modifiÃ©</p>
                            </div>
                            <div style="background: white; padding: 1rem; border-radius: 8px; text-align: center;">
                                <div style="font-size: 2rem; margin-bottom: 0.5rem;">4ï¸âƒ£</div>
                                <strong style="color: var(--bleu);">C'est en ligne !</strong>
                                <p style="font-size: 0.9rem; color: var(--gris-texte);">Le site se met Ã  jour en 1-2 minutes</p>
                            </div>
                        </div>
                    </div>

                    <!-- ONGLETS -->
                    <h3 style="color: var(--bleu); margin-bottom: 1rem;">ğŸ“‘ Les onglets</h3>
                    <div style="display: grid; gap: 1rem; margin-bottom: 2rem;">
                        <div style="display: flex; align-items: center; gap: 1rem; padding: 1rem; background: var(--gris-bg); border-radius: 8px;">
                            <span style="font-size: 1.5rem;">ğŸš€</span>
                            <div>
                                <strong style="color: var(--bleu);">Projets</strong>
                                <p style="font-size: 0.9rem; margin: 0;">Les projets du programme 2026-2032 â†’ Page "Notre Projet"</p>
                            </div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 1rem; padding: 1rem; background: var(--gris-bg); border-radius: 8px;">
                            <span style="font-size: 1.5rem;">ğŸ“Š</span>
                            <div>
                                <strong style="color: var(--bleu);">Actions</strong>
                                <p style="font-size: 0.9rem; margin: 0;">Les 330 actions du bilan 2020-2026 â†’ Page "Bilan"</p>
                            </div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 1rem; padding: 1rem; background: var(--gris-bg); border-radius: 8px;">
                            <span style="font-size: 1.5rem;">ğŸ‘¥</span>
                            <div>
                                <strong style="color: var(--bleu);">Candidats</strong>
                                <p style="font-size: 0.9rem; margin: 0;">L'Ã©quipe et les colistiers avec photos â†’ Page "Ã‰quipe"</p>
                            </div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 1rem; padding: 1rem; background: var(--gris-bg); border-radius: 8px;">
                            <span style="font-size: 1.5rem;">ğŸ’¬</span>
                            <div>
                                <strong style="color: var(--bleu);">Construisons ensemble</strong>
                                <p style="font-size: 0.9rem; margin: 0;">Questions, idÃ©es, contact â†’ Page "Construisons ensemble"</p>
                            </div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 1rem; padding: 1rem; background: var(--gris-bg); border-radius: 8px;">
                            <span style="font-size: 1.5rem;">ğŸ“°</span>
                            <div>
                                <strong style="color: var(--bleu);">Articles</strong>
                                <p style="font-size: 0.9rem; margin: 0;">ActualitÃ©s et communiquÃ©s â†’ Page "Blog"</p>
                            </div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 1rem; padding: 1rem; background: var(--gris-bg); border-radius: 8px;">
                            <span style="font-size: 1.5rem;">ğŸ“¢</span>
                            <div>
                                <strong style="color: var(--bleu);">Communication</strong>
                                <p style="font-size: 0.9rem; margin: 0;">AbonnÃ©s newsletter, partage Facebook, envoi newsletter</p>
                            </div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 1rem; padding: 1rem; background: var(--gris-bg); border-radius: 8px;">
                            <span style="font-size: 1.5rem;">âš™ï¸</span>
                            <div>
                                <strong style="color: var(--bleu);">ParamÃ¨tres</strong>
                                <p style="font-size: 0.9rem; margin: 0;">CoordonnÃ©es, rÃ©seaux sociaux, permanences â†’ Page "Construisons ensemble"</p>
                            </div>
                        </div>
                    </div>

                    <!-- STATUTS -->
                    <h3 style="color: var(--bleu); margin-bottom: 1rem;">ğŸš¦ Les statuts</h3>
                    <div style="display: flex; gap: 2rem; flex-wrap: wrap; margin-bottom: 2rem;">
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <span style="background: var(--vert); color: white; padding: 0.3rem 0.75rem; border-radius: 20px; font-size: 0.85rem;">âœ“ Ã€ jour</span>
                            <span>= Aucune modification en attente</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <span style="background: var(--orange); color: white; padding: 0.3rem 0.75rem; border-radius: 20px; font-size: 0.85rem;">âš ï¸ ModifiÃ©</span>
                            <span>= Modifications Ã  publier</span>
                        </div>
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <span style="background: rgba(0,0,0,0.3); color: white; padding: 0.3rem 0.75rem; border-radius: 20px; font-size: 0.85rem;">â³ Publication...</span>
                            <span>= Envoi en cours</span>
                        </div>
                    </div>

                    <!-- TOKEN -->
                    <div style="background: #1b1f23; color: white; padding: 1.5rem; border-radius: 12px; margin-bottom: 2rem;">
                        <h3 style="margin-bottom: 1rem;">ğŸ” Le Token GitHub</h3>
                        <p style="margin-bottom: 1rem;">Le token permet de publier directement sur le site. Il est sauvegardÃ© dans votre navigateur.</p>
                        <ul style="margin-left: 1.5rem; line-height: 2;">
                            <li>Collez-le dans le champ ğŸ” en haut de page</li>
                            <li>Cliquez sur ğŸ‘ï¸ pour le voir/masquer</li>
                            <li>Il est mÃ©morisÃ© automatiquement</li>
                        </ul>
                        <p style="margin-top: 1rem; padding: 0.75rem; background: rgba(255,255,255,0.1); border-radius: 8px; font-size: 0.9rem;">
                            âš ï¸ Ne partagez pas ce token publiquement. Demandez-le Ã  Michel si besoin.
                        </p>
                    </div>

                    <!-- LIENS -->
                    <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                        <a href="https://Vizilleenmouvement.github.io/Vizille-en-mouvement/" target="_blank" style="display: inline-flex; align-items: center; gap: 0.5rem; background: var(--bleu); color: white; padding: 0.75rem 1.5rem; border-radius: 8px; text-decoration: none; font-weight: 600;">
                            ğŸŒ Voir le site en ligne
                        </a>
                        <a href="https://github.com/Vizilleenmouvement/Vizille-en-mouvement" target="_blank" style="display: inline-flex; align-items: center; gap: 0.5rem; background: #333; color: white; padding: 0.75rem 1.5rem; border-radius: 8px; text-decoration: none; font-weight: 600;">
                            ğŸ“ Voir sur GitHub
                        </a>
                    </div>
                </div>
            </div>
        </section>

        <!-- TAB: PROJETS -->
        <section class="tab-content" id="tab-projets">
            <div class="card">
                <div class="card-header">
                    <h2>ğŸš€ Projets 2026-2032</h2>
                    <div class="publish-bar">
                        <span class="status saved" id="status-projets">âœ“ Ã€ jour</span>
                        <button class="btn-publish" onclick="publish('projets')">ğŸš€ Publier</button>
                    </div>
                </div>
                <div class="card-body">
                    <button class="btn btn-primary" onclick="openAddProjet()">+ Ajouter un projet</button>
                    
                    <!-- FILTRES PAR THÃˆME -->
                    <div style="margin: 1.5rem 0;">
                        <h4 style="color: var(--bleu); margin-bottom: 0.75rem;">Filtrer par thÃ¨me :</h4>
                        <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;" id="projet-theme-filters">
                            <button class="theme-btn active" data-theme="" onclick="filterProjets('')">
                                ğŸ“‹ Tous (<span id="pcount-all">0</span>)
                            </button>
                            <button class="theme-btn" data-theme="urbanisme" onclick="filterProjets('urbanisme')">
                                ğŸ˜ï¸ Urbanisme (<span id="pcount-urbanisme">0</span>)
                            </button>
                            <button class="theme-btn" data-theme="environnement" onclick="filterProjets('environnement')">
                                ğŸŒ¿ Environnement (<span id="pcount-environnement">0</span>)
                            </button>
                            <button class="theme-btn" data-theme="solidarite" onclick="filterProjets('solidarite')">
                                ğŸ¤ SolidaritÃ© (<span id="pcount-solidarite">0</span>)
                            </button>
                            <button class="theme-btn" data-theme="sante" onclick="filterProjets('sante')">
                                ğŸ¥ SantÃ© (<span id="pcount-sante">0</span>)
                            </button>
                            <button class="theme-btn" data-theme="enfance" onclick="filterProjets('enfance')">
                                ğŸ‘¶ Enfance (<span id="pcount-enfance">0</span>)
                            </button>
                            <button class="theme-btn" data-theme="culture" onclick="filterProjets('culture')">
                                ğŸ­ Culture (<span id="pcount-culture">0</span>)
                            </button>
                            <button class="theme-btn" data-theme="sport" onclick="filterProjets('sport')">
                                âš½ Sport (<span id="pcount-sport">0</span>)
                            </button>
                            <button class="theme-btn" data-theme="economie" onclick="filterProjets('economie')">
                                ğŸ’¼ Ã‰conomie (<span id="pcount-economie">0</span>)
                            </button>
                            <button class="theme-btn" data-theme="tranquillite" onclick="filterProjets('tranquillite')">
                                ğŸ›¡ï¸ TranquillitÃ© (<span id="pcount-tranquillite">0</span>)
                            </button>
                            <button class="theme-btn" data-theme="mobilites" onclick="filterProjets('mobilites')">
                                ğŸš´ MobilitÃ©s (<span id="pcount-mobilites">0</span>)
                            </button>
                            <button class="theme-btn" data-theme="seniors" onclick="filterProjets('seniors')">
                                ğŸ‘´ Seniors (<span id="pcount-seniors">0</span>)
                            </button>
                            <button class="theme-btn" data-theme="democratie" onclick="filterProjets('democratie')">
                                ğŸ—£ï¸ DÃ©mocratie (<span id="pcount-democratie">0</span>)
                            </button>
                            <button class="theme-btn" data-theme="metropole" onclick="filterProjets('metropole')">
                                ğŸ›ï¸ MÃ©tropole (<span id="pcount-metropole">0</span>)
                            </button>
                        </div>
                    </div>
                    
                    <div class="items-list">
                        <div class="items-header">
                            <h3>Projets affichÃ©s : <span id="projets-count">0</span></h3>
                            <input type="text" id="search-projets" placeholder="ğŸ” Rechercher..." style="padding: 0.5rem 1rem; border: 2px solid var(--gris-border); border-radius: 8px; width: 200px;" oninput="renderProjets()">
                        </div>
                        <div id="projets-list"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- TAB: THÃˆMES -->
        <section class="tab-content" id="tab-themes">
            <div class="card">
                <div class="card-header">
                    <h2>ğŸ¨ Gestion des ThÃ¨mes</h2>
                    <div class="publish-bar">
                        <span class="status saved" id="status-themes">âœ“ Ã€ jour</span>
                        <button class="btn-publish" onclick="publish('themes')">ğŸš€ Publier</button>
                    </div>
                </div>
                <div class="card-body">
                    <p style="color: #666; margin-bottom: 1.5rem;">
                        GÃ©rez les thÃ¨mes disponibles pour classer vos projets. Un thÃ¨me ne peut Ãªtre supprimÃ© que s'il n'est rattachÃ© Ã  aucun projet.
                    </p>
                    
                    <!-- Formulaire d'ajout -->
                    <div style="display: flex; gap: 10px; margin-bottom: 2rem; padding: 1rem; background: #f8f9fa; border-radius: 8px; flex-wrap: wrap; align-items: flex-end;">
                        <div class="form-group" style="margin: 0; flex: 1; min-width: 150px;">
                            <label style="font-size: 0.85rem;">Nom du thÃ¨me</label>
                            <input type="text" id="new-theme-name" placeholder="Ex: NumÃ©rique" maxlength="30" style="width: 100%;">
                        </div>
                        <div class="form-group" style="margin: 0; width: 80px;">
                            <label style="font-size: 0.85rem;">IcÃ´ne</label>
                            <select id="new-theme-icon" style="width: 100%; font-size: 1.2rem; text-align: center;">
                                <option value="ğŸ“Œ">ğŸ“Œ</option>
                                <option value="ğŸ¥">ğŸ¥</option>
                                <option value="ğŸ˜ï¸">ğŸ˜ï¸</option>
                                <option value="ğŸŒ¿">ğŸŒ¿</option>
                                <option value="ğŸ­">ğŸ­</option>
                                <option value="ğŸ›ï¸">ğŸ›ï¸</option>
                                <option value="ğŸ‘¶">ğŸ‘¶</option>
                                <option value="ğŸ¤">ğŸ¤</option>
                                <option value="âš½">âš½</option>
                                <option value="ğŸ’¼">ğŸ’¼</option>
                                <option value="ğŸš´">ğŸš´</option>
                                <option value="ğŸ›¡ï¸">ğŸ›¡ï¸</option>
                                <option value="ğŸ—ï¸">ğŸ—ï¸</option>
                                <option value="ğŸ’°">ğŸ’°</option>
                                <option value="ğŸ‘¥">ğŸ‘¥</option>
                                <option value="ğŸ“š">ğŸ“š</option>
                                <option value="ğŸ“">ğŸ“</option>
                                <option value="ğŸ—³ï¸">ğŸ—³ï¸</option>
                                <option value="ğŸ¯">ğŸ¯</option>
                                <option value="ğŸŒ">ğŸŒ</option>
                                <option value="ğŸš—">ğŸš—</option>
                                <option value="ğŸ ">ğŸ </option>
                                <option value="ğŸ’¡">ğŸ’¡</option>
                                <option value="ğŸ“±">ğŸ“±</option>
                                <option value="ğŸŒ³">ğŸŒ³</option>
                                <option value="ğŸ‘´">ğŸ‘´</option>
                                <option value="ğŸ—£ï¸">ğŸ—£ï¸</option>
                                <option value="ğŸª">ğŸª</option>
                                <option value="ğŸ†">ğŸ†</option>
                                <option value="ğŸ”§">ğŸ”§</option>
                            </select>
                        </div>
                        <div class="form-group" style="margin: 0; width: 80px;">
                            <label style="font-size: 0.85rem;">Couleur</label>
                            <input type="color" id="new-theme-color" value="#1a3a5c" style="width: 100%; height: 38px; border: none; border-radius: 4px; cursor: pointer;">
                        </div>
                        <button class="btn btn-primary" onclick="addNewTheme()" style="height: 38px;">
                            + Ajouter
                        </button>
                    </div>
                    
                    <!-- Liste des thÃ¨mes -->
                    <h4 style="color: var(--bleu); margin-bottom: 1rem;">ThÃ¨mes existants (<span id="themes-count">0</span>)</h4>
                    <div id="themes-list" style="display: grid; gap: 10px;">
                        <!-- GÃ©nÃ©rÃ© dynamiquement -->
                    </div>
                </div>
            </div>
        </section>

        <!-- TAB: ACTIONS -->
        <section class="tab-content" id="tab-actions">
            <div class="card">
                <div class="card-header">
                    <h2>ğŸ“Š Actions du Bilan 2020-2026</h2>
                    <div class="publish-bar">
                        <span class="status saved" id="status-actions">âœ“ Ã€ jour</span>
                        <button class="btn-publish" onclick="publish('actions')">ğŸš€ Publier</button>
                    </div>
                </div>
                <div class="card-body">
                    <button class="btn btn-primary" onclick="openAddAction()">+ Ajouter une action</button>
                    
                    <!-- FILTRES PAR THÃˆME -->
                    <div style="margin: 1.5rem 0;">
                        <h4 style="color: var(--bleu); margin-bottom: 0.75rem;">Filtrer par thÃ¨me :</h4>
                        <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;" id="theme-filters">
                            <button class="theme-btn active" data-theme="" onclick="filterActions('')">
                                ğŸ“‹ Tous (<span id="count-all">0</span>)
                            </button>
                            <button class="theme-btn" data-theme="Urbanisme" onclick="filterActions('Urbanisme')">
                                ğŸ—ï¸ Urbanisme (<span id="count-Urbanisme">0</span>)
                            </button>
                            <button class="theme-btn" data-theme="SantÃ©" onclick="filterActions('SantÃ©')">
                                ğŸ¥ SantÃ© (<span id="count-SantÃ©">0</span>)
                            </button>
                            <button class="theme-btn" data-theme="Environnement" onclick="filterActions('Environnement')">
                                ğŸŒ± Environnement (<span id="count-Environnement">0</span>)
                            </button>
                            <button class="theme-btn" data-theme="Culture" onclick="filterActions('Culture')">
                                ğŸ­ Culture (<span id="count-Culture">0</span>)
                            </button>
                            <button class="theme-btn" data-theme="Patrimoine" onclick="filterActions('Patrimoine')">
                                ğŸ›ï¸ Patrimoine (<span id="count-Patrimoine">0</span>)
                            </button>
                            <button class="theme-btn" data-theme="Enfance" onclick="filterActions('Enfance')">
                                ğŸ‘¶ Enfance (<span id="count-Enfance">0</span>)
                            </button>
                            <button class="theme-btn" data-theme="SolidaritÃ©" onclick="filterActions('SolidaritÃ©')">
                                ğŸ¤ SolidaritÃ© (<span id="count-SolidaritÃ©">0</span>)
                            </button>
                            <button class="theme-btn" data-theme="Sport" onclick="filterActions('Sport')">
                                âš½ Sport (<span id="count-Sport">0</span>)
                            </button>
                            <button class="theme-btn" data-theme="Ã‰conomie" onclick="filterActions('Ã‰conomie')">
                                ğŸ’¼ Ã‰conomie (<span id="count-Ã‰conomie">0</span>)
                            </button>
                            <button class="theme-btn" data-theme="TranquillitÃ©" onclick="filterActions('TranquillitÃ©')">
                                ğŸ›¡ï¸ TranquillitÃ© (<span id="count-TranquillitÃ©">0</span>)
                            </button>
                            <button class="theme-btn" data-theme="MobilitÃ©s" onclick="filterActions('MobilitÃ©s')">
                                ğŸš² MobilitÃ©s (<span id="count-MobilitÃ©s">0</span>)
                            </button>
                            <button class="theme-btn" data-theme="Finance" onclick="filterActions('Finance')">
                                ğŸ’° Finance (<span id="count-Finance">0</span>)
                            </button>
                        </div>
                    </div>
                    
                    <div class="items-list">
                        <div class="items-header">
                            <h3>Actions affichÃ©es : <span id="actions-count">0</span></h3>
                            <input type="text" id="search-actions" placeholder="ğŸ” Rechercher..." style="padding: 0.5rem 1rem; border: 2px solid var(--gris-border); border-radius: 8px; width: 200px;" oninput="renderActions()">
                        </div>
                        <div id="actions-list"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- TAB: CANDIDATS -->
        <section class="tab-content" id="tab-candidats">
            <div class="card">
                <div class="card-header">
                    <h2>ğŸ‘¥ Candidats</h2>
                    <div class="publish-bar">
                        <span class="status saved" id="status-candidats">âœ“ Ã€ jour</span>
                        <button class="btn-publish" onclick="publish('candidats')">ğŸš€ Publier</button>
                    </div>
                </div>
                <div class="card-body">
                    <button class="btn btn-primary" onclick="openAddCandidat()">+ Ajouter un candidat</button>
                    
                    <div class="items-list">
                        <div class="items-header">
                            <h3>Candidats (<span id="candidats-count">0</span>)</h3>
                        </div>
                        <div id="candidats-list"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- TAB: FAQ -->
        <section class="tab-content" id="tab-faq">
            <div class="card">
                <div class="card-header">
                    <h2>ğŸ¤ Construisons ensemble - Questions / RÃ©ponses</h2>
                    <div class="publish-bar">
                        <span class="status saved" id="status-faq">âœ“ Ã€ jour</span>
                        <button class="btn-publish" onclick="publish('faq')">ğŸš€ Publier</button>
                    </div>
                </div>
                <div class="card-body">
                    <button class="btn btn-primary" onclick="openAddFaq()">+ Ajouter une question</button>
                    
                    <div class="items-list">
                        <div class="items-header">
                            <h3>Questions (<span id="faq-count">0</span>)</h3>
                        </div>
                        <div id="faq-list"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- TAB: ARTICLES -->
        <section class="tab-content" id="tab-articles">
            <div class="card">
                <div class="card-header">
                    <h2>ğŸ“° Articles / ActualitÃ©s</h2>
                    <div class="publish-bar">
                        <span class="status saved" id="status-articles">âœ“ Ã€ jour</span>
                        <button class="btn-publish" onclick="publish('articles')">ğŸš€ Publier</button>
                    </div>
                </div>
                <div class="card-body">
                    <button class="btn btn-primary" onclick="openAddArticle()">+ Ajouter un article</button>
                    
                    <div class="items-list">
                        <div class="items-header">
                            <h3>Articles (<span id="articles-count">0</span>)</h3>
                        </div>
                        <div id="articles-list"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- TAB: COMMUNICATION -->
        <section class="tab-content" id="tab-communication">
            <!-- ABONNÃ‰S NEWSLETTER -->
            <div class="card">
                <div class="card-header">
                    <h2>ğŸ“§ AbonnÃ©s Newsletter</h2>
                    <div class="publish-bar">
                        <span class="status saved" id="status-abonnes">âœ“ Ã€ jour</span>
                        <button class="btn-publish" onclick="publish('abonnes')">ğŸš€ Publier</button>
                    </div>
                </div>
                <div class="card-body">
                    <div style="display: flex; gap: 1rem; margin-bottom: 1.5rem; flex-wrap: wrap;">
                        <button class="btn btn-primary" onclick="openAddAbonne()">+ Ajouter un abonnÃ©</button>
                        <button class="btn btn-outline" onclick="exportAbonnes()">ğŸ“¥ Exporter (CSV)</button>
                        <button class="btn btn-outline" onclick="document.getElementById('import-abonnes').click()">ğŸ“¤ Importer</button>
                        <input type="file" id="import-abonnes" accept=".csv,.txt" style="display:none" onchange="importAbonnes(event)">
                    </div>
                    
                    <div style="background: #e8f4fc; padding: 1rem; border-radius: 8px; margin-bottom: 1.5rem;">
                        <strong style="color: var(--bleu);">ğŸ“Š Statistiques :</strong>
                        <span id="stats-abonnes">0 abonnÃ©s actifs</span>
                    </div>
                    
                    <div class="items-list">
                        <div class="items-header">
                            <h3>Liste des abonnÃ©s (<span id="abonnes-count">0</span>)</h3>
                            <input type="text" id="search-abonnes" placeholder="ğŸ” Rechercher..." style="padding: 0.5rem 1rem; border: 2px solid var(--gris-border); border-radius: 8px; width: 200px;" oninput="renderAbonnes()">
                        </div>
                        <div id="abonnes-list"></div>
                    </div>
                </div>
            </div>

            <!-- PARTAGE FACEBOOK -->
            <div class="card">
                <div class="card-header" style="background: linear-gradient(135deg, #1877f2 0%, #42b72a 100%);">
                    <h2>ğŸ“˜ Partage Facebook</h2>
                </div>
                <div class="card-body">
                    <p style="margin-bottom: 1rem; color: var(--gris-texte);">SÃ©lectionnez un article puis gÃ©nÃ©rez un post prÃªt Ã  copier-coller sur Facebook.</p>
                    
                    <div class="form-group">
                        <label>Choisir un article Ã  partager</label>
                        <select id="fb-article-select" onchange="previewFacebookPost()">
                            <option value="">-- SÃ©lectionnez un article --</option>
                        </select>
                    </div>
                    
                    <div id="fb-preview-zone" style="display: none;">
                        <div class="form-group">
                            <label>Texte du post (modifiable)</label>
                            <textarea id="fb-post-text" rows="5" style="font-size: 1rem;"></textarea>
                        </div>
                        
                        <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                            <button class="btn btn-primary" onclick="copyFacebookPost()" style="background: #1877f2;">
                                ğŸ“‹ Copier le texte
                            </button>
                            <button class="btn btn-outline" onclick="window.open('https://www.facebook.com/', '_blank')">
                                ğŸ“˜ Ouvrir Facebook
                            </button>
                        </div>
                        
                        <div style="background: #f0f2f5; padding: 1rem; border-radius: 8px; margin-top: 1.5rem;">
                            <strong style="color: #1877f2;">ğŸ’¡ Mode d'emploi :</strong>
                            <ol style="margin: 0.5rem 0 0 1.5rem; color: var(--gris-texte);">
                                <li>Cliquez sur "Copier le texte"</li>
                                <li>Ouvrez Facebook</li>
                                <li>CrÃ©ez un nouveau post et collez (Ctrl+V)</li>
                                <li>Publiez !</li>
                            </ol>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Ã‰DITEUR NEWSLETTER -->
            <div class="card">
                <div class="card-header" style="background: linear-gradient(135deg, #9b59b6 0%, #3498db 100%);">
                    <h2>ğŸ“¬ RÃ©diger la Newsletter</h2>
                </div>
                <div class="card-body">
                    <p style="margin-bottom: 1.5rem; color: var(--gris-texte);">Composez votre newsletter hebdomadaire. Le contenu sera prÃªt Ã  copier dans Brevo.</p>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Objet de l'email</label>
                            <input type="text" id="nl-objet" placeholder="Ex: Vizille en Mouvement - ActualitÃ©s de la semaine">
                        </div>
                        <div class="form-group">
                            <label>Date</label>
                            <input type="date" id="nl-date">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Introduction</label>
                        <textarea id="nl-intro" rows="3" placeholder="Chers Vizillois, voici les actualitÃ©s de la semaine..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label>Contenu principal</label>
                        <textarea id="nl-contenu" rows="8" placeholder="- Ã‰vÃ©nement 1&#10;- Ã‰vÃ©nement 2&#10;- ActualitÃ© importante..."></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label>Appel Ã  l'action (optionnel)</label>
                        <input type="text" id="nl-cta" placeholder="Ex: Rejoignez-nous samedi Ã  18h pour notre rÃ©union publique !">
                    </div>
                    
                    <div style="display: flex; gap: 1rem; flex-wrap: wrap; margin-top: 1.5rem;">
                        <button class="btn btn-primary" onclick="generateNewsletter()" style="background: #9b59b6;">
                            âœ¨ GÃ©nÃ©rer la newsletter
                        </button>
                        <button class="btn btn-outline" onclick="clearNewsletter()">
                            ğŸ—‘ï¸ Effacer
                        </button>
                    </div>
                    
                    <div id="nl-result" style="display: none; margin-top: 1.5rem;">
                        <div class="form-group">
                            <label>ğŸ“„ Newsletter gÃ©nÃ©rÃ©e (prÃªte Ã  copier)</label>
                            <textarea id="nl-output" rows="12" readonly style="background: #f8f9fa; font-family: monospace;"></textarea>
                        </div>
                        <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                            <button class="btn btn-success" onclick="copyNewsletter()">
                                ğŸ“‹ Copier le contenu
                            </button>
                            <button class="btn btn-outline" onclick="copyAbonnesEmails()">
                                ğŸ“§ Copier les emails des abonnÃ©s
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- TAB: PARAMÃˆTRES -->
        <section class="tab-content" id="tab-config">
            <div class="card">
                <div class="card-header">
                    <h2>âš™ï¸ ParamÃ¨tres du site</h2>
                    <div class="publish-bar">
                        <span class="status saved" id="status-config">âœ“ Ã€ jour</span>
                        <button class="btn-publish" onclick="publish('config')">ğŸš€ Publier</button>
                    </div>
                </div>
                <div class="card-body">
                    <h3 style="color: var(--bleu); margin-bottom: 1rem;">ğŸ“§ CoordonnÃ©es</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Email de contact</label>
                            <input type="email" id="config-email" placeholder="contact@Vizille-en-mouvement.fr" onchange="markModified('config')">
                        </div>
                        <div class="form-group">
                            <label>TÃ©lÃ©phone</label>
                            <input type="tel" id="config-telephone" placeholder="04 76 XX XX XX" onchange="markModified('config')">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Adresse / Lieu de permanence</label>
                        <input type="text" id="config-adresse" placeholder="Vizille, France" onchange="markModified('config')">
                    </div>

                    <h3 style="color: var(--bleu); margin: 2rem 0 1rem;">ğŸ“± RÃ©seaux sociaux</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label>ğŸ“˜ Facebook (URL)</label>
                            <input type="url" id="config-facebook" placeholder="https://facebook.com/Vizilleenmouvement" onchange="markModified('config')">
                        </div>
                        <div class="form-group">
                            <label>ğŸ“¸ Instagram (URL)</label>
                            <input type="url" id="config-instagram" placeholder="https://instagram.com/Vizilleenmouvement" onchange="markModified('config')">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>ğŸ¦ Twitter / X (URL)</label>
                            <input type="url" id="config-twitter" placeholder="https://twitter.com/Vizilleenmouvement" onchange="markModified('config')">
                        </div>
                        <div class="form-group">
                            <label>ğŸ”— Autre lien</label>
                            <input type="url" id="config-autre" placeholder="https://..." onchange="markModified('config')">
                        </div>
                    </div>

                    <h3 style="color: var(--bleu); margin: 2rem 0 1rem;">ğŸ• Permanences</h3>
                    <div class="form-group">
                        <label>Informations sur les permanences</label>
                        <textarea id="config-permanences" rows="3" placeholder="Ex: Tous les samedis de 10h Ã  12h Ã  la salle des fÃªtes..." onchange="markModified('config')"></textarea>
                    </div>

                    <h3 style="color: var(--bleu); margin: 2rem 0 1rem;">ğŸ¨ Personnalisation</h3>
                    <div class="form-group">
                        <label>Slogan</label>
                        <input type="text" id="config-slogan" placeholder="Vos questions pour une ville dynamique et solidaire" onchange="markModified('config')">
                    </div>

                    <h3 style="color: var(--bleu); margin: 2rem 0 1rem;">ğŸ”’ TranquillitÃ©</h3>
                    <div style="background: #fef3cd; border: 1px solid #ffc107; border-radius: 8px; padding: 1rem; margin-bottom: 1rem;">
                        <p style="margin: 0; color: #856404;">âš ï¸ Le mot de passe est stockÃ© dans votre navigateur. Chaque utilisateur peut dÃ©finir le sien.</p>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Ancien mot de passe</label>
                            <input type="password" id="old-password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢">
                        </div>
                        <div class="form-group">
                            <label>Nouveau mot de passe</label>
                            <input type="password" id="new-password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢">
                        </div>
                        <div class="form-group">
                            <label>Confirmer</label>
                            <input type="password" id="confirm-password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢">
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="changePassword()">ğŸ” Changer le mot de passe</button>
                </div>
            </div>
        </section>

    </main>

    <!-- TOAST -->
    <div class="toast" id="toast"></div>

    <!-- MODAL -->
    <div class="modal-overlay" id="modal-edit">
        <div class="modal">
            <div class="modal-header">
                <h3 id="modal-title">Modifier</h3>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body" id="modal-body"></div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="closeModal()">Annuler</button>
                <button class="btn btn-primary" id="modal-save">Enregistrer</button>
            </div>
        </div>
    </div>

    <script>
        // ===== CONFIGURATION =====
        const GITHUB_CONFIG = {
            owner: 'Vizilleenmouvement',
            repo: 'Vizille-en-mouvement',
            branch: 'main'
        };

        // Mot de passe par dÃ©faut hashÃ© (@@@@@ = 5 @)
        const DEFAULT_PASSWORD_HASH = 'YXQ0dml6aWxsZTIwMjY2NDczMTI5MDEx';
        
        // ===== AUTHENTIFICATION =====
        function simpleHash(str) {
            // Hash simple pour ne pas stocker en clair
            let hash = 0;
            for (let i = 0; i < str.length; i++) {
                const char = str.charCodeAt(i);
                hash = ((hash << 5) - hash) + char;
                hash = hash & hash;
            }
            return btoa('at4' + str + hash + '1');
        }
        
        function checkPassword() {
            const input = document.getElementById('login-password').value;
            const storedHash = localStorage.getItem('vizille_admin_password') || DEFAULT_PASSWORD_HASH;
            const inputHash = simpleHash(input);
            
            if (inputHash === storedHash) {
                document.getElementById('login-overlay').classList.add('hidden');
                document.getElementById('login-error').textContent = '';
                loadAllData();
            } else {
                document.getElementById('login-error').textContent = 'âŒ Mot de passe incorrect';
                document.getElementById('login-password').value = '';
            }
        }
        
        function changePassword() {
            const oldPwd = document.getElementById('old-password').value;
            const newPwd = document.getElementById('new-password').value;
            const confirmPwd = document.getElementById('confirm-password').value;
            
            // VÃ©rifier l'ancien mot de passe
            const storedHash = localStorage.getItem('vizille_admin_password') || DEFAULT_PASSWORD_HASH;
            if (simpleHash(oldPwd) !== storedHash) {
                showToast('âŒ Ancien mot de passe incorrect', 'error');
                return;
            }
            
            // VÃ©rifier la confirmation
            if (newPwd !== confirmPwd) {
                showToast('âŒ Les mots de passe ne correspondent pas', 'error');
                return;
            }
            
            // VÃ©rifier la longueur
            if (newPwd.length < 3) {
                showToast('âŒ Mot de passe trop court (min 3 caractÃ¨res)', 'error');
                return;
            }
            
            // Sauvegarder le nouveau mot de passe
            localStorage.setItem('vizille_admin_password', simpleHash(newPwd));
            
            // Vider les champs
            document.getElementById('old-password').value = '';
            document.getElementById('new-password').value = '';
            document.getElementById('confirm-password').value = '';
            
            showToast('âœ… Mot de passe changÃ© !', 'success');
        }

        const THEMES_PROJETS = [
            { value: 'urbanisme', label: 'ğŸ—ï¸ Urbanisme' },
            { value: 'sante', label: 'ğŸ¥ SantÃ©' },
            { value: 'environnement', label: 'ğŸŒ± Environnement' },
            { value: 'culture', label: 'ğŸ­ Culture' },
            { value: 'patrimoine', label: 'ğŸ›ï¸ Patrimoine' },
            { value: 'enfance', label: 'ğŸ‘¶ Enfance' },
            { value: 'solidarite', label: 'ğŸ¤ SolidaritÃ©' },
            { value: 'sport', label: 'âš½ Sport' },
            { value: 'economie', label: 'ğŸ’¼ Ã‰conomie' },
            { value: 'tranquillite', label: 'ğŸ›¡ï¸ TranquillitÃ©' },
            { value: 'mobilites', label: 'ğŸš² MobilitÃ©s' },
            { value: 'finances', label: 'ğŸ’° Finances' }
        ];

        const THEMES_ACTIONS = [
            { value: 'Urbanisme', label: 'ğŸ—ï¸ Urbanisme' },
            { value: 'SantÃ©', label: 'ğŸ¥ SantÃ©' },
            { value: 'Environnement', label: 'ğŸŒ± Environnement' },
            { value: 'Culture', label: 'ğŸ­ Culture' },
            { value: 'Patrimoine', label: 'ğŸ›ï¸ Patrimoine' },
            { value: 'Enfance', label: 'ğŸ‘¶ Enfance' },
            { value: 'SolidaritÃ©', label: 'ğŸ¤ SolidaritÃ©' },
            { value: 'Sport', label: 'âš½ Sport' },
            { value: 'Ã‰conomie', label: 'ğŸ’¼ Ã‰conomie' },
            { value: 'TranquillitÃ©', label: 'ğŸ›¡ï¸ TranquillitÃ©' },
            { value: 'MobilitÃ©s', label: 'ğŸš² MobilitÃ©s' },
            { value: 'Finance', label: 'ğŸ’° Finance' }
        ];

        // ===== DONNÃ‰ES =====
        let data = {
            projets: [],
            themes: [],
            actions: [],
            candidats: [],
            faq: [],
            articles: [],
            abonnes: [],
            config: {
                email: '',
                telephone: '',
                adresse: '',
                facebook: '',
                instagram: '',
                twitter: '',
                autre: '',
                permanences: '',
                slogan: 'Vos questions pour une ville dynamique et solidaire'
            }
        };

        let currentEdit = { type: null, index: null };
        let pendingPhoto = null;

        // ===== INITIALISATION =====
        document.addEventListener('DOMContentLoaded', () => {
            setupTabs();
            loadToken();
            loadAllData();
        });

        function setupTabs() {
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    tab.classList.add('active');
                    document.getElementById('tab-' + tab.dataset.tab).classList.add('active');
                });
            });
        }

        // ===== TOKEN =====
        function loadToken() {
            const saved = localStorage.getItem('vizille_github_token');
            if (saved) document.getElementById('github-token').value = saved;
        }

        function saveToken() {
            const token = document.getElementById('github-token').value;
            localStorage.setItem('vizille_github_token', token);
            showToast('ğŸ” Token sauvegardÃ©', 'success');
        }

        function toggleToken() {
            const input = document.getElementById('github-token');
            input.type = input.type === 'password' ? 'text' : 'password';
        }

        function getToken() {
            return document.getElementById('github-token').value;
        }

        // ===== CHARGEMENT DONNÃ‰ES =====
        async function loadAllData() {
            showToast('â³ Chargement des donnÃ©es...', 'info');
            
            const files = {
                projets: 'projets.json',
                themes: 'themes.json',
                actions: 'data.json',
                candidats: 'candidats.json',
                faq: 'faq.json',
                articles: 'articles.json',
                abonnes: 'abonnes.json',
                config: 'config.json'
            };

            for (const [key, file] of Object.entries(files)) {
                setStatus(key, 'loading', 'â³...');
                try {
                    const url = `https://raw.githubusercontent.com/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/${GITHUB_CONFIG.branch}/${file}`;
                    console.log(`Chargement de ${file}...`, url);
                    const response = await fetch(url);
                    if (response.ok) {
                        const loaded = await response.json();
                        if (key === 'config') {
                            data.config = { ...data.config, ...loaded };
                        } else if (key === 'themes') {
                            data.themes = loaded;
                            // Mettre Ã  jour THEMES_CONFIG depuis les donnÃ©es chargÃ©es
                            THEMES_CONFIG = [...loaded];
                        } else {
                            data[key] = loaded;
                        }
                        console.log(`âœ… ${file} chargÃ©:`, loaded.length !== undefined ? `${loaded.length} Ã©lÃ©ments` : 'OK');
                        setStatus(key, 'saved', 'âœ“ Ã€ jour');
                    } else {
                        console.warn(`âš ï¸ ${file} - Erreur HTTP ${response.status}`);
                        setStatus(key, 'modified', `âš ï¸ Erreur ${response.status}`);
                    }
                } catch (err) {
                    console.error(`âŒ ${file} - Erreur:`, err.message);
                    setStatus(key, 'modified', 'âŒ Erreur');
                }
            }

            renderAll();
            showToast('âœ… DonnÃ©es chargÃ©es !', 'success');
        }

        // ===== STATUS =====
        function setStatus(section, state, text) {
            const el = document.getElementById('status-' + section);
            if (el) {
                el.textContent = text;
                el.className = 'status ' + state;
            }
        }

        function markModified(section) {
            setStatus(section, 'modified', 'âš ï¸ ModifiÃ©');
        }

        // ===== RENDER ALL =====
        function renderAll() {
            renderProjets();
            renderThemesList();
            renderActions();
            renderCandidats();
            renderFaq();
            renderArticles();
            renderAbonnes();
            renderFacebookSelect();
            renderConfig();
            initNewsletterDate();
        }

        function getThemeLabel(themes, value) {
            const t = themes.find(t => t.value === value);
            return t ? t.label : value;
        }

        // ===== PROJETS =====
        let currentProjetFilter = '';
        
        function filterProjets(theme) {
            currentProjetFilter = theme;
            // Mettre Ã  jour les boutons actifs
            document.querySelectorAll('#projet-theme-filters .theme-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.theme === theme);
            });
            renderProjets();
        }
        
        function updateProjetCounts() {
            // Compter les projets par thÃ¨me (directement depuis les donnÃ©es)
            const counts = {};
            data.projets.forEach(p => {
                const theme = (p.theme || '').toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g, '');
                counts[theme] = (counts[theme] || 0) + 1;
            });
            
            // Mettre Ã  jour le compteur total
            const allEl = document.getElementById('pcount-all');
            if (allEl) allEl.textContent = data.projets.length;
            
            // Mettre Ã  jour les compteurs par thÃ¨me
            document.querySelectorAll('[id^="pcount-"]').forEach(el => {
                const theme = el.id.replace('pcount-', '');
                if (theme !== 'all') {
                    el.textContent = counts[theme] || 0;
                }
            });
        }
        
        function renderProjets() {
            updateProjetCounts();
            
            const search = (document.getElementById('search-projets')?.value || '').toLowerCase();
            
            let filtered = data.projets;
            
            // Filtre par thÃ¨me (supporte themes[] et theme)
            if (currentProjetFilter) {
                filtered = filtered.filter(p => {
                    const themes = getProjetThemes(p);
                    return themes.some(t => t.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g, '').includes(currentProjetFilter.toLowerCase()));
                });
            }
            
            // Filtre par recherche
            if (search) {
                filtered = filtered.filter(p => {
                    const themesStr = getProjetThemes(p).join(' ').toLowerCase();
                    return (p.titre || '').toLowerCase().includes(search) ||
                        themesStr.includes(search) ||
                        (p.resume || '').toLowerCase().includes(search) ||
                        (p.description || '').toLowerCase().includes(search);
                });
            }
            
            document.getElementById('projets-count').textContent = filtered.length;
            document.getElementById('projets-list').innerHTML = filtered.length === 0 
                ? '<div class="empty-state"><div class="icon">ğŸ“­</div><p>Aucun projet trouvÃ©</p></div>'
                : filtered.map((p, i) => {
                    const themes = getProjetThemes(p);
                    const primaryTheme = themes[0] || 'Non dÃ©fini';
                    const themeConf = THEMES_CONFIG.find(t => t.theme === primaryTheme) || { icon: 'ğŸ“‹', color: '#1a3a5c' };
                    
                    // Badges pour tous les thÃ¨mes
                    const themeBadges = themes.map(t => {
                        const conf = THEMES_CONFIG.find(tc => tc.theme === t) || { icon: 'ğŸ“‹', color: '#1a3a5c' };
                        return `<span style="background: ${conf.color}; color: white; padding: 0.2rem 0.5rem; border-radius: 4px; font-size: 0.75rem; margin-right: 0.3rem;">${conf.icon} ${t}</span>`;
                    }).join('');
                    
                    return `
                    <div class="item-card" style="border-left: 4px solid ${themeConf.color}">
                        <div class="item-info">
                            <div class="item-text">
                                <div class="item-title">${themeConf.icon} ${p.titre || 'Sans titre'}</div>
                                <div class="item-desc">
                                    ${themeBadges}
                                    <span style="color: #666;">${p.statut || ''} ${p.annee ? 'â€¢ ' + p.annee : ''}</span>
                                    ${p.resume ? '<br><em style="color: #888;">' + p.resume + '</em>' : ''}
                                </div>
                            </div>
                        </div>
                        <div class="item-actions">
                            <button class="btn btn-sm btn-primary" onclick="openEditProjet(${data.projets.indexOf(p)})">âœï¸</button>
                            <button class="btn btn-sm btn-danger" onclick="deleteProjet(${data.projets.indexOf(p)})">ğŸ—‘ï¸</button>
                        </div>
                    </div>
                `}).join('');
        }

        function openAddProjet() {
            currentEdit = { type: 'projet', index: -1 };
            showProjetModal({});
        }

        function openEditProjet(index) {
            currentEdit = { type: 'projet', index };
            showProjetModal(data.projets[index]);
        }

        // Configuration des thÃ¨mes par dÃ©faut (sera remplacÃ©e par themes.json au chargement)
        let THEMES_CONFIG = [
            { theme: 'Urbanisme', icon: 'ğŸ˜ï¸', color: '#34495e' },
            { theme: 'Environnement', icon: 'ğŸŒ¿', color: '#27ae60' },
            { theme: 'SolidaritÃ©', icon: 'ğŸ¤', color: '#e74c3c' },
            { theme: 'SantÃ©', icon: 'ğŸ¥', color: '#e91e63' },
            { theme: 'Enfance', icon: 'ğŸ‘¶', color: '#3498db' },
            { theme: 'Culture', icon: 'ğŸ­', color: '#9b59b6' },
            { theme: 'Sport', icon: 'âš½', color: '#4caf50' },
            { theme: 'Ã‰conomie', icon: 'ğŸ’¼', color: '#f39c12' },
            { theme: 'TranquillitÃ©', icon: 'ğŸ›¡ï¸', color: '#2c3e50' },
            { theme: 'MobilitÃ©s', icon: 'ğŸš´', color: '#1abc9c' },
            { theme: 'Seniors', icon: 'ğŸ‘´', color: '#795548' },
            { theme: 'DÃ©mocratie locale', icon: 'ğŸ—£ï¸', color: '#607d8b' },
            { theme: 'MÃ©tropole', icon: 'ğŸ›ï¸', color: '#00bcd4' }
        ];
        
        // ===== GESTION DES THÃˆMES =====
        function renderThemesList() {
            // Compter les projets par thÃ¨me
            const themeCounts = {};
            (data.projets || []).forEach(p => {
                const themes = getProjetThemes(p);
                themes.forEach(t => {
                    themeCounts[t] = (themeCounts[t] || 0) + 1;
                });
            });
            
            document.getElementById('themes-count').textContent = THEMES_CONFIG.length;
            
            const container = document.getElementById('themes-list');
            container.innerHTML = THEMES_CONFIG.map((t, index) => {
                const count = themeCounts[t.theme] || 0;
                const hasProjects = count > 0;
                return `
                    <div style="display: flex; align-items: center; gap: 15px; padding: 12px 15px; background: #f8f9fa; border-radius: 8px; border-left: 4px solid ${t.color};">
                        <span style="font-size: 1.5rem;">${t.icon}</span>
                        <span style="flex: 1; font-weight: 600;">${t.theme}</span>
                        <span style="background: ${t.color}; color: white; padding: 4px 12px; border-radius: 20px; font-size: 0.85rem;">
                            ${count} projet${count > 1 ? 's' : ''}
                        </span>
                        <button class="btn btn-sm btn-danger" 
                                onclick="deleteTheme(${index})" 
                                title="${hasProjects ? 'Supprimer et rÃ©assigner les projets' : 'Supprimer ce thÃ¨me'}">
                            ğŸ—‘ï¸
                        </button>
                    </div>
                `;
            }).join('');
        }
        
        function addNewTheme() {
            const nameInput = document.getElementById('new-theme-name');
            const iconSelect = document.getElementById('new-theme-icon');
            const colorInput = document.getElementById('new-theme-color');
            
            const name = nameInput.value.trim();
            const icon = iconSelect.value;
            const color = colorInput.value;
            
            if (!name) {
                showToast('âš ï¸ Veuillez entrer un nom de thÃ¨me', 'warning');
                return;
            }
            
            if (THEMES_CONFIG.some(t => t.theme.toLowerCase() === name.toLowerCase())) {
                showToast('âš ï¸ Ce thÃ¨me existe dÃ©jÃ ', 'warning');
                return;
            }
            
            THEMES_CONFIG.push({ theme: name, icon, color });
            THEMES_CONFIG.sort((a, b) => a.theme.localeCompare(b.theme));
            data.themes = [...THEMES_CONFIG];
            markModified('themes');
            
            // RÃ©initialiser le formulaire
            nameInput.value = '';
            iconSelect.value = 'ğŸ“Œ';
            colorInput.value = '#1a3a5c';
            
            renderThemesList();
            showToast('âœ… ThÃ¨me ajoutÃ© : ' + name + ' (pensez Ã  publier)', 'success');
        }
        
        function deleteTheme(index) {
            const theme = THEMES_CONFIG[index];
            
            // Compter les projets qui utilisent ce thÃ¨me
            const projetsWithTheme = (data.projets || []).filter(p => {
                const themes = getProjetThemes(p);
                return themes.includes(theme.theme);
            });
            
            if (projetsWithTheme.length > 0) {
                // Afficher la modal de rÃ©assignation
                showReassignModal(index, theme, projetsWithTheme.length);
                return;
            }
            
            // Pas de projets, suppression directe
            if (!confirm(`Supprimer le thÃ¨me "${theme.theme}" ?`)) {
                return;
            }
            
            THEMES_CONFIG.splice(index, 1);
            data.themes = [...THEMES_CONFIG];
            markModified('themes');
            
            renderThemesList();
            showToast('âœ… ThÃ¨me supprimÃ© (pensez Ã  publier)', 'success');
        }
        
        function showReassignModal(themeIndex, theme, projetCount) {
            // CrÃ©er les options pour le select (tous les thÃ¨mes sauf celui Ã  supprimer)
            const otherThemes = THEMES_CONFIG.filter((t, i) => i !== themeIndex);
            const options = otherThemes.map(t => 
                `<option value="${t.theme}">${t.icon} ${t.theme}</option>`
            ).join('');
            
            // CrÃ©er la modal
            const modalHTML = `
                <div id="reassign-modal" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.6); display: flex; align-items: center; justify-content: center; z-index: 9999;">
                    <div style="background: white; border-radius: 12px; padding: 2rem; max-width: 450px; width: 90%; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
                        <h3 style="color: var(--bleu); margin-bottom: 1rem;">ğŸ”„ RÃ©assigner les projets</h3>
                        <p style="color: #666; margin-bottom: 1.5rem;">
                            <strong>${projetCount} projet${projetCount > 1 ? 's' : ''}</strong> utilise${projetCount > 1 ? 'nt' : ''} le thÃ¨me <strong style="color: ${theme.color};">${theme.icon} ${theme.theme}</strong>.
                        </p>
                        <p style="color: #666; margin-bottom: 1rem;">Vers quel thÃ¨me souhaitez-vous les dÃ©placer ?</p>
                        <select id="reassign-target" style="width: 100%; padding: 10px; border: 2px solid var(--gris-border); border-radius: 8px; font-size: 1rem; margin-bottom: 1.5rem;">
                            ${options}
                        </select>
                        <div style="display: flex; gap: 10px; justify-content: flex-end;">
                            <button class="btn" onclick="closeReassignModal()" style="background: #e0e0e0; color: #666;">Annuler</button>
                            <button class="btn btn-primary" onclick="confirmReassign(${themeIndex}, '${theme.theme}')">RÃ©assigner et supprimer</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHTML);
        }
        
        function closeReassignModal() {
            const modal = document.getElementById('reassign-modal');
            if (modal) modal.remove();
        }
        
        function confirmReassign(themeIndex, oldThemeName) {
            const newTheme = document.getElementById('reassign-target').value;
            
            // RÃ©assigner tous les projets
            let reassigned = 0;
            (data.projets || []).forEach(p => {
                const themes = getProjetThemes(p);
                const idx = themes.indexOf(oldThemeName);
                if (idx !== -1) {
                    // Remplacer l'ancien thÃ¨me par le nouveau
                    themes[idx] = newTheme;
                    // Supprimer les doublons si le nouveau thÃ¨me Ã©tait dÃ©jÃ  prÃ©sent
                    p.themes = [...new Set(themes)];
                    p.theme = p.themes[0]; // RÃ©trocompatibilitÃ©
                    reassigned++;
                }
            });
            
            // Supprimer le thÃ¨me
            THEMES_CONFIG.splice(themeIndex, 1);
            data.themes = [...THEMES_CONFIG];
            
            // Marquer comme modifiÃ©
            markModified('themes');
            markModified('projets');
            
            closeReassignModal();
            renderThemesList();
            renderProjets();
            
            showToast(`âœ… ${reassigned} projet${reassigned > 1 ? 's' : ''} rÃ©assignÃ©${reassigned > 1 ? 's' : ''} vers "${newTheme}" (pensez Ã  publier)`, 'success');
        }

        // Helper pour obtenir les thÃ¨mes d'un projet (supporte theme ou themes)
        function getProjetThemes(p) {
            if (p.themes && Array.isArray(p.themes)) {
                return p.themes;
            }
            return p.theme ? [p.theme] : [];
        }
        
        // Toggle un badge de thÃ¨me (sÃ©lection/dÃ©sÃ©lection)
        function toggleThemeBadge(el) {
            const isSelected = el.classList.contains('selected');
            const color = el.dataset.color;
            
            if (isSelected) {
                el.classList.remove('selected');
                el.style.background = '#e0e0e0';
                el.style.color = '#666';
                el.style.borderColor = 'transparent';
            } else {
                el.classList.add('selected');
                el.style.background = color;
                el.style.color = 'white';
                el.style.borderColor = color;
            }
        }

        function showProjetModal(p) {
            document.getElementById('modal-title').textContent = currentEdit.index === -1 ? 'â• Ajouter un projet' : 'âœï¸ Modifier le projet';
            
            const currentThemes = getProjetThemes(p);
            const themeBadges = THEMES_CONFIG.map(t => {
                const isSelected = currentThemes.includes(t.theme);
                return `<span class="theme-badge-select ${isSelected ? 'selected' : ''}" 
                              data-theme="${t.theme}" 
                              data-color="${t.color}"
                              onclick="toggleThemeBadge(this)"
                              style="background: ${isSelected ? t.color : '#e0e0e0'}; 
                                     color: ${isSelected ? 'white' : '#666'}; 
                                     padding: 6px 12px; 
                                     border-radius: 20px; 
                                     font-size: 0.85rem; 
                                     cursor: pointer; 
                                     margin: 4px;
                                     display: inline-block;
                                     transition: all 0.2s ease;
                                     border: 2px solid ${isSelected ? t.color : 'transparent'};">
                        ${t.icon} ${t.theme}
                       </span>`;
            }).join('');
            
            const statutOptions = ['ProgrammÃ©', 'En cours', 'Prioritaire', 'Ã‰tude'].map(s =>
                `<option value="${s}" ${p.statut === s ? 'selected' : ''}>${s}</option>`
            ).join('');
            
            // PrÃ©parer les chiffres existants
            const chiffresHTML = (p.chiffres || []).map((c, i) => `
                <div class="chiffre-row" style="display: grid; grid-template-columns: 1fr 2fr auto; gap: 0.5rem; margin-bottom: 0.5rem;">
                    <input type="text" class="chiffre-valeur" value="${c.valeur || ''}" placeholder="Ex: 150 000 â‚¬">
                    <input type="text" class="chiffre-label" value="${c.label || ''}" placeholder="Ex: Budget total">
                    <button type="button" class="btn btn-danger btn-sm" onclick="this.parentElement.remove()">ğŸ—‘ï¸</button>
                </div>
            `).join('');
            
            // PrÃ©parer la chronologie existante
            const chronoHTML = (p.chronologie || []).map((c, i) => `
                <div class="chrono-row" style="display: grid; grid-template-columns: 120px 1fr auto; gap: 0.5rem; margin-bottom: 0.5rem;">
                    <input type="text" class="chrono-date" value="${c.date || ''}" placeholder="Ex: 2027">
                    <input type="text" class="chrono-event" value="${c.evenement || ''}" placeholder="Ex: Lancement des travaux">
                    <button type="button" class="btn btn-danger btn-sm" onclick="this.parentElement.remove()">ğŸ—‘ï¸</button>
                </div>
            `).join('');
            
            // PrÃ©parer les documents existants
            const docsHTML = (p.documents || []).map((d, i) => `
                <div class="doc-row" style="display: grid; grid-template-columns: 1fr 2fr auto; gap: 0.5rem; margin-bottom: 0.5rem;">
                    <input type="text" class="doc-nom" value="${d.nom || ''}" placeholder="Nom du document">
                    <input type="text" class="doc-url" value="${d.url || ''}" placeholder="URL ou chemin">
                    <button type="button" class="btn btn-danger btn-sm" onclick="this.parentElement.remove()">ğŸ—‘ï¸</button>
                </div>
            `).join('');
            
            // PrÃ©parer les images existantes
            const imagesHTML = (p.images || []).map((img, i) => `
                <div class="img-row" style="display: grid; grid-template-columns: 2fr 1fr auto; gap: 0.5rem; margin-bottom: 0.5rem;">
                    <input type="text" class="img-url" value="${img.url || ''}" placeholder="URL de l'image">
                    <input type="text" class="img-alt" value="${img.alt || ''}" placeholder="Description">
                    <button type="button" class="btn btn-danger btn-sm" onclick="this.parentElement.remove()">ğŸ—‘ï¸</button>
                </div>
            `).join('');
            
            document.getElementById('modal-body').innerHTML = `
                <div class="form-group">
                    <label>Titre du projet *</label>
                    <input type="text" id="edit-titre" value="${p.titre || ''}" placeholder="Ex: CrÃ©ation d'une maison de santÃ©">
                </div>
                <div class="form-group">
                    <label>ThÃ¨me(s) * <small style="color: #888; font-weight: normal;">(cliquer pour sÃ©lectionner)</small></label>
                    <div id="themes-badges" style="display: flex; flex-wrap: wrap; padding: 10px; background: #f8f9fa; border-radius: 8px; border: 1px solid var(--gris-border);">
                        ${themeBadges}
                    </div>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div class="form-group">
                        <label>Statut</label>
                        <select id="edit-statut">
                            ${statutOptions}
                        </select>
                    </div>
                    <div class="form-group">
                        <label>AnnÃ©e prÃ©vue</label>
                        <select id="edit-annee">
                            <option value="">--</option>
                            ${[2026, 2027, 2028, 2029, 2030, 2031, 2032].map(a => 
                                `<option value="${a}" ${p.annee == a ? 'selected' : ''}>${a}</option>`
                            ).join('')}
                        </select>
                    </div>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                    <div class="form-group">
                        <label>Importance (1-3)</label>
                        <select id="edit-importance">
                            <option value="1" ${p.importance == 1 ? 'selected' : ''}>1 - Normal</option>
                            <option value="2" ${p.importance == 2 ? 'selected' : ''}>2 - Important</option>
                            <option value="3" ${p.importance == 3 ? 'selected' : ''}>3 - Prioritaire</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Budget estimÃ© (â‚¬)</label>
                        <input type="number" id="edit-budget" value="${p.budget || 0}" placeholder="0">
                    </div>
                </div>
                <div class="form-group">
                    <label>RÃ©sumÃ© court</label>
                    <input type="text" id="edit-resume" value="${p.resume || ''}" placeholder="Ex: AccÃ¨s aux soins pour tous">
                </div>
                <div class="form-group">
                    <label>Description dÃ©taillÃ©e</label>
                    <textarea id="edit-description" rows="4" placeholder="Description complÃ¨te du projet...">${p.description || ''}</textarea>
                </div>
                
                <hr style="margin: 1.5rem 0; border: none; border-top: 2px solid var(--or);">
                <h4 style="color: var(--bleu); margin-bottom: 1rem;">ğŸ–¼ï¸ Illustration</h4>
                
                <div class="form-group">
                    <label>Image principale (URL)</label>
                    <input type="text" id="edit-image" value="${p.image || ''}" placeholder="Ex: images/projets/mon-projet.jpg">
                </div>
                
                <div class="form-group">
                    <label>Galerie d'images</label>
                    <div id="images-container">${imagesHTML}</div>
                    <button type="button" class="btn btn-outline btn-sm" onclick="addImageRow()" style="margin-top: 0.5rem;">+ Ajouter une image</button>
                </div>
                
                <hr style="margin: 1.5rem 0; border: none; border-top: 2px solid var(--or);">
                <h4 style="color: var(--bleu); margin-bottom: 1rem;">ğŸ“Š Objectifs chiffrÃ©s</h4>
                
                <div class="form-group">
                    <label>Chiffres clÃ©s</label>
                    <div id="chiffres-container">${chiffresHTML}</div>
                    <button type="button" class="btn btn-outline btn-sm" onclick="addChiffreRow()" style="margin-top: 0.5rem;">+ Ajouter un chiffre</button>
                </div>
                
                <hr style="margin: 1.5rem 0; border: none; border-top: 2px solid var(--or);">
                <h4 style="color: var(--bleu); margin-bottom: 1rem;">ğŸ“… Calendrier prÃ©visionnel</h4>
                
                <div class="form-group">
                    <label>Ã‰tapes du projet</label>
                    <div id="chrono-container">${chronoHTML}</div>
                    <button type="button" class="btn btn-outline btn-sm" onclick="addChronoRow()" style="margin-top: 0.5rem;">+ Ajouter une Ã©tape</button>
                </div>
                
                <hr style="margin: 1.5rem 0; border: none; border-top: 2px solid var(--or);">
                <h4 style="color: var(--bleu); margin-bottom: 1rem;">ğŸ“ Documents joints</h4>
                
                <div class="form-group">
                    <label>Documents (PDF, Ã©tudes, plans...)</label>
                    <div id="docs-container">${docsHTML}</div>
                    <button type="button" class="btn btn-outline btn-sm" onclick="addDocRow()" style="margin-top: 0.5rem;">+ Ajouter un document</button>
                </div>
                
                <hr style="margin: 1.5rem 0; border: none; border-top: 2px solid var(--or);">
                <h4 style="color: var(--bleu); margin-bottom: 1rem;">ğŸ“ Informations complÃ©mentaires</h4>
                
                <div class="form-group">
                    <label>DÃ©tails supplÃ©mentaires</label>
                    <textarea id="edit-details" rows="3" placeholder="Informations complÃ©mentaires, contexte, partenaires...">${p.details || ''}</textarea>
                </div>
            `;
            document.getElementById('modal-save').onclick = saveProjet;
            document.getElementById('modal-edit').classList.add('active');
        }
        
        // Fonctions pour ajouter des lignes dynamiquement
        function addChiffreRow() {
            const container = document.getElementById('chiffres-container');
            const row = document.createElement('div');
            row.className = 'chiffre-row';
            row.style.cssText = 'display: grid; grid-template-columns: 1fr 2fr auto; gap: 0.5rem; margin-bottom: 0.5rem;';
            row.innerHTML = `
                <input type="text" class="chiffre-valeur" placeholder="Ex: 150 000 â‚¬">
                <input type="text" class="chiffre-label" placeholder="Ex: Budget total">
                <button type="button" class="btn btn-danger btn-sm" onclick="this.parentElement.remove()">ğŸ—‘ï¸</button>
            `;
            container.appendChild(row);
        }
        
        function addChronoRow() {
            const container = document.getElementById('chrono-container');
            const row = document.createElement('div');
            row.className = 'chrono-row';
            row.style.cssText = 'display: grid; grid-template-columns: 120px 1fr auto; gap: 0.5rem; margin-bottom: 0.5rem;';
            row.innerHTML = `
                <input type="text" class="chrono-date" placeholder="Ex: 2027">
                <input type="text" class="chrono-event" placeholder="Ex: Lancement des travaux">
                <button type="button" class="btn btn-danger btn-sm" onclick="this.parentElement.remove()">ğŸ—‘ï¸</button>
            `;
            container.appendChild(row);
        }
        
        function addDocRow() {
            const container = document.getElementById('docs-container');
            const row = document.createElement('div');
            row.className = 'doc-row';
            row.style.cssText = 'display: grid; grid-template-columns: 1fr 2fr auto; gap: 0.5rem; margin-bottom: 0.5rem;';
            row.innerHTML = `
                <input type="text" class="doc-nom" placeholder="Nom du document">
                <input type="text" class="doc-url" placeholder="URL ou chemin">
                <button type="button" class="btn btn-danger btn-sm" onclick="this.parentElement.remove()">ğŸ—‘ï¸</button>
            `;
            container.appendChild(row);
        }
        
        function addImageRow() {
            const container = document.getElementById('images-container');
            const row = document.createElement('div');
            row.className = 'img-row';
            row.style.cssText = 'display: grid; grid-template-columns: 2fr 1fr auto; gap: 0.5rem; margin-bottom: 0.5rem;';
            row.innerHTML = `
                <input type="text" class="img-url" placeholder="URL de l'image">
                <input type="text" class="img-alt" placeholder="Description">
                <button type="button" class="btn btn-danger btn-sm" onclick="this.parentElement.remove()">ğŸ—‘ï¸</button>
            `;
            container.appendChild(row);
        }

        function updateThemePreview() {
            // Plus nÃ©cessaire avec le nouveau formulaire
        }

        function saveProjet() {
            const titre = document.getElementById('edit-titre').value.trim();
            
            // RÃ©cupÃ©rer les thÃ¨mes sÃ©lectionnÃ©s (badges)
            const themes = [];
            document.querySelectorAll('#themes-badges .theme-badge-select.selected').forEach(badge => {
                themes.push(badge.dataset.theme);
            });
            
            const statut = document.getElementById('edit-statut').value;
            const annee = parseInt(document.getElementById('edit-annee').value) || null;
            const importance = parseInt(document.getElementById('edit-importance').value) || 1;
            const resume = document.getElementById('edit-resume').value.trim();
            const description = document.getElementById('edit-description').value.trim();
            const budget = parseInt(document.getElementById('edit-budget').value) || 0;
            
            // Nouveaux champs
            const image = document.getElementById('edit-image').value.trim();
            const details = document.getElementById('edit-details').value.trim();
            
            // RÃ©cupÃ©rer les chiffres
            const chiffres = [];
            document.querySelectorAll('#chiffres-container .chiffre-row').forEach(row => {
                const valeur = row.querySelector('.chiffre-valeur').value.trim();
                const label = row.querySelector('.chiffre-label').value.trim();
                if (valeur || label) {
                    chiffres.push({ valeur, label });
                }
            });
            
            // RÃ©cupÃ©rer la chronologie
            const chronologie = [];
            document.querySelectorAll('#chrono-container .chrono-row').forEach(row => {
                const date = row.querySelector('.chrono-date').value.trim();
                const evenement = row.querySelector('.chrono-event').value.trim();
                if (date || evenement) {
                    chronologie.push({ date, evenement });
                }
            });
            
            // RÃ©cupÃ©rer les documents
            const documents = [];
            document.querySelectorAll('#docs-container .doc-row').forEach(row => {
                const nom = row.querySelector('.doc-nom').value.trim();
                const url = row.querySelector('.doc-url').value.trim();
                if (nom || url) {
                    documents.push({ nom, url });
                }
            });
            
            // RÃ©cupÃ©rer les images de la galerie
            const images = [];
            document.querySelectorAll('#images-container .img-row').forEach(row => {
                const url = row.querySelector('.img-url').value.trim();
                const alt = row.querySelector('.img-alt').value.trim();
                if (url) {
                    images.push({ url, alt });
                }
            });
            
            if (!titre || themes.length === 0) {
                showToast('âš ï¸ Titre et au moins un thÃ¨me obligatoires', 'warning');
                return;
            }

            const projet = {
                id: currentEdit.index === -1 ? Date.now() : data.projets[currentEdit.index].id,
                titre,
                themes,  // tableau de thÃ¨mes
                theme: themes[0],  // rÃ©trocompatibilitÃ© : premier thÃ¨me
                statut,
                annee,
                budget,
                resume,
                description,
                importance,
                image,
                images,
                chiffres,
                chronologie,
                documents,
                details,
                // Conserver les sources existantes si modification
                sources: currentEdit.index === -1 ? [] : (data.projets[currentEdit.index].sources || []),
                lien_source: currentEdit.index === -1 ? [] : (data.projets[currentEdit.index].lien_source || [])
            };

            if (currentEdit.index === -1) {
                data.projets.push(projet);
            } else {
                data.projets[currentEdit.index] = projet;
            }
            
            markModified('projets');
            renderProjets();
            closeModal();
            showToast('âœ… Projet enregistrÃ©', 'success');
        }


        function deleteProjet(index) {
            if (confirm('Supprimer ce projet ?')) {
                data.projets.splice(index, 1);
                markModified('projets');
                renderProjets();
                showToast('ğŸ—‘ï¸ Projet supprimÃ©', 'success');
            }
        }

        // ===== ACTIONS =====
        let currentActionFilter = '';
        
        function filterActions(theme) {
            currentActionFilter = theme;
            // Mettre Ã  jour les boutons actifs
            document.querySelectorAll('.theme-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.theme === theme);
            });
            renderActions();
        }
        
        function updateThemeCounts() {
            // Compter les actions par thÃ¨me
            const counts = {};
            THEMES_ACTIONS.forEach(t => counts[t.value] = 0);
            data.actions.forEach(a => {
                if (counts[a.theme] !== undefined) counts[a.theme]++;
            });
            
            // Mettre Ã  jour les compteurs
            document.getElementById('count-all').textContent = data.actions.length;
            THEMES_ACTIONS.forEach(t => {
                const el = document.getElementById('count-' + t.value);
                if (el) el.textContent = counts[t.value];
            });
        }
        
        function renderActions() {
            updateThemeCounts();
            
            const search = (document.getElementById('search-actions')?.value || '').toLowerCase();
            
            let filtered = data.actions;
            
            // Filtre par thÃ¨me
            if (currentActionFilter) {
                filtered = filtered.filter(a => a.theme === currentActionFilter);
            }
            
            // Filtre par recherche
            if (search) {
                filtered = filtered.filter(a => 
                    (a.titre || '').toLowerCase().includes(search) ||
                    (a.description || '').toLowerCase().includes(search)
                );
            }
            
            document.getElementById('actions-count').textContent = filtered.length;
            document.getElementById('actions-list').innerHTML = filtered.length === 0
                ? '<div class="empty-state"><div class="icon">ğŸ“­</div><p>Aucune action trouvÃ©e</p></div>'
                : filtered.map((a, i) => `
                    <div class="item-card">
                        <div class="item-info">
                            <div class="item-text">
                                <span class="item-badge">${a.theme} â€¢ ${a.statut || 'RÃ©alisÃ©'}</span>
                                <div class="item-title">${a.titre}</div>
                                <div class="item-desc">${a.description || ''}</div>
                            </div>
                        </div>
                        <div class="item-actions">
                            <button class="btn btn-sm btn-primary" onclick="openEditAction(${data.actions.indexOf(a)})">âœï¸</button>
                            <button class="btn btn-sm btn-danger" onclick="deleteAction(${data.actions.indexOf(a)})">ğŸ—‘ï¸</button>
                        </div>
                    </div>
                `).join('');
        }

        function openAddAction() {
            currentEdit = { type: 'action', index: -1 };
            showActionModal({});
        }

        function openEditAction(index) {
            currentEdit = { type: 'action', index };
            showActionModal(data.actions[index]);
        }

        function showActionModal(a) {
            document.getElementById('modal-title').textContent = currentEdit.index === -1 ? 'â• Ajouter une action' : 'âœï¸ Modifier l\'action';
            document.getElementById('modal-body').innerHTML = `
                <div class="form-group">
                    <label>Titre *</label>
                    <input type="text" id="edit-titre" value="${a.titre || ''}">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>ThÃ¨me *</label>
                        <select id="edit-theme">
                            <option value="">-- Choisir --</option>
                            ${THEMES_ACTIONS.map(t => `<option value="${t.value}" ${a.theme === t.value ? 'selected' : ''}>${t.label}</option>`).join('')}
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Statut</label>
                        <select id="edit-statut">
                            <option value="RÃ©alisÃ©" ${a.statut === 'RÃ©alisÃ©' ? 'selected' : ''}>âœ… RÃ©alisÃ©</option>
                            <option value="En cours" ${a.statut === 'En cours' ? 'selected' : ''}>ğŸ”„ En cours</option>
                            <option value="PrÃ©vu" ${a.statut === 'PrÃ©vu' ? 'selected' : ''}>ğŸ“… PrÃ©vu</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Description</label>
                    <textarea id="edit-description" rows="3">${a.description || ''}</textarea>
                </div>
            `;
            document.getElementById('modal-save').onclick = saveAction;
            document.getElementById('modal-edit').classList.add('active');
        }

        function saveAction() {
            const titre = document.getElementById('edit-titre').value.trim();
            const theme = document.getElementById('edit-theme').value;
            const statut = document.getElementById('edit-statut').value;
            const description = document.getElementById('edit-description').value.trim();
            
            if (!titre || !theme) {
                showToast('âš ï¸ Titre et thÃ¨me obligatoires', 'warning');
                return;
            }

            if (currentEdit.index === -1) {
                data.actions.push({ id: Date.now(), titre, theme, statut, description });
            } else {
                Object.assign(data.actions[currentEdit.index], { titre, theme, statut, description });
            }
            
            markModified('actions');
            renderActions();
            closeModal();
            showToast('âœ… Action enregistrÃ©e', 'success');
        }

        function deleteAction(index) {
            if (confirm('Supprimer cette action ?')) {
                data.actions.splice(index, 1);
                markModified('actions');
                renderActions();
                showToast('ğŸ—‘ï¸ Action supprimÃ©e', 'success');
            }
        }

        // ===== CANDIDATS =====
        function getPhotoUrl(photo) {
            if (!photo) return null;
            // Ignorer les chemins locaux
            if (photo.startsWith('file://')) return null;
            // Si c'est dÃ©jÃ  une URL complÃ¨te
            if (photo.startsWith('http')) return photo;
            // Si c'est un chemin relatif, construire l'URL GitHub
            return `https://raw.githubusercontent.com/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/${GITHUB_CONFIG.branch}/${photo}`;
        }

        function renderCandidats() {
            document.getElementById('candidats-count').textContent = data.candidats.length;
            const sorted = [...data.candidats].sort((a, b) => (a.ordre || 99) - (b.ordre || 99));
            
            document.getElementById('candidats-list').innerHTML = sorted.length === 0
                ? '<div class="empty-state"><div class="icon">ğŸ‘¥</div><p>Aucun candidat</p></div>'
                : sorted.map((c, i) => {
                    const realIndex = data.candidats.indexOf(c);
                    const photoUrl = getPhotoUrl(c.photo);
                    const photoHtml = photoUrl 
                        ? `<img src="${photoUrl}" class="item-photo" alt="${c.nom}" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                           <div class="item-photo-placeholder" style="display:none;">ğŸ‘¤</div>`
                        : `<div class="item-photo-placeholder">ğŸ‘¤</div>`;
                    
                    let badges = [];
                    if (c.role) badges.push(c.role);
                    if (c.delegation) badges.push(c.delegation);
                    
                    let socials = [];
                    if (c.email) socials.push('ğŸ“§');
                    if (c.facebook) socials.push('ğŸ“˜');
                    if (c.linkedin) socials.push('ğŸ’¼');
                    if (c.twitter) socials.push('ğŸ¦');
                    
                    return `
                        <div class="item-card">
                            <div class="item-info">
                                ${photoHtml}
                                <div class="item-text">
                                    <div class="item-title">${c.nom} ${socials.length ? '<span style="font-size: 0.8rem; opacity: 0.7;">' + socials.join(' ') + '</span>' : ''}</div>
                                    ${badges.length ? `<span class="item-badge">${badges.join(' â€¢ ')}</span>` : ''}
                                    <div class="item-desc">${c.bio ? c.bio.substring(0, 80) + '...' : ''}</div>
                                    ${c.citation ? `<div class="item-desc" style="font-style: italic; color: var(--or);">Â« ${c.citation.substring(0, 50)}... Â»</div>` : ''}
                                </div>
                            </div>
                            <div class="item-actions">
                                <button class="btn btn-sm btn-primary" onclick="openEditCandidat(${realIndex})">âœï¸</button>
                                <button class="btn btn-sm btn-danger" onclick="deleteCandidat(${realIndex})">ğŸ—‘ï¸</button>
                            </div>
                        </div>
                    `;
                }).join('');
        }

        function openAddCandidat() {
            currentEdit = { type: 'candidat', index: -1 };
            pendingPhoto = null;
            showCandidatModal({});
        }

        function openEditCandidat(index) {
            currentEdit = { type: 'candidat', index };
            pendingPhoto = null;
            showCandidatModal(data.candidats[index]);
        }

        function showCandidatModal(c) {
            const photoUrl = getPhotoUrl(c.photo);
            document.getElementById('modal-title').textContent = currentEdit.index === -1 ? 'â• Ajouter un candidat' : 'âœï¸ Modifier le candidat';
            document.getElementById('modal-body').innerHTML = `
                <div class="form-row">
                    <div class="form-group">
                        <label>Nom complet *</label>
                        <input type="text" id="edit-nom" value="${c.nom || ''}">
                    </div>
                    <div class="form-group">
                        <label>Ordre d'affichage</label>
                        <input type="number" id="edit-ordre" value="${c.ordre || 10}" min="1">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>RÃ´le / Fonction</label>
                        <input type="text" id="edit-role" value="${c.role || ''}" placeholder="Ex: Adjoint aux finances">
                    </div>
                    <div class="form-group">
                        <label>DÃ©lÃ©gation / Domaine</label>
                        <input type="text" id="edit-delegation" value="${c.delegation || ''}" placeholder="Ex: Urbanisme, Environnement">
                    </div>
                </div>
                <div class="form-group">
                    <label>Biographie</label>
                    <textarea id="edit-bio" rows="3" placeholder="Courte prÃ©sentation...">${c.bio || ''}</textarea>
                </div>
                <div class="form-group">
                    <label>ğŸ“ Parcours</label>
                    <textarea id="edit-pedigree" rows="3" placeholder="Formation, expÃ©riences professionnelles, engagements passÃ©s...">${c.pedigree || ''}</textarea>
                </div>
                <div class="form-group">
                    <label>ğŸ¯ Objectifs de campagne</label>
                    <textarea id="edit-objectifs" rows="3" placeholder="Mes prioritÃ©s pour Vizille...">${c.objectifs || ''}</textarea>
                </div>
                <div class="form-group">
                    <label>ğŸ’¬ Citation / Engagement personnel</label>
                    <input type="text" id="edit-citation" value="${c.citation || ''}" placeholder="Ex: Mon engagement pour Vizille...">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>ğŸ“§ Email (optionnel)</label>
                        <input type="email" id="edit-email" value="${c.email || ''}" placeholder="prenom.nom@email.com">
                    </div>
                    <div class="form-group">
                        <label>ğŸ“˜ Facebook (URL)</label>
                        <input type="url" id="edit-facebook" value="${c.facebook || ''}" placeholder="https://facebook.com/...">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>ğŸ’¼ LinkedIn (URL)</label>
                        <input type="url" id="edit-linkedin" value="${c.linkedin || ''}" placeholder="https://linkedin.com/in/...">
                    </div>
                    <div class="form-group">
                        <label>ğŸ¦ Twitter (URL)</label>
                        <input type="url" id="edit-twitter" value="${c.twitter || ''}" placeholder="https://twitter.com/...">
                    </div>
                </div>
                <div class="form-group">
                    <label>Photo</label>
                    <div class="photo-upload" onclick="document.getElementById('photo-input').click()" 
                         ondragover="event.preventDefault(); this.classList.add('dragover')"
                         ondragleave="this.classList.remove('dragover')"
                         ondrop="handlePhotoDrop(event)">
                        <input type="file" id="photo-input" accept="image/*" onchange="handlePhotoSelect(event)">
                        <div class="icon">ğŸ“·</div>
                        <p>Cliquez ou glissez une photo</p>
                        <p style="font-size: 0.8rem; opacity: 0.7;">Max 1 Mo â€¢ JPG, PNG</p>
                    </div>
                    <div class="photo-preview ${photoUrl ? 'active' : ''}" id="photo-preview">
                        <img src="${photoUrl || ''}" id="photo-preview-img" onerror="this.parentElement.classList.remove('active');">
                        <button class="btn btn-sm btn-danger" style="margin-top: 0.5rem;" onclick="removePhoto()">ğŸ—‘ï¸ Supprimer</button>
                    </div>
                </div>
            `;
            document.getElementById('modal-save').onclick = saveCandidat;
            document.getElementById('modal-edit').classList.add('active');
        }

        function handlePhotoSelect(event) {
            const file = event.target.files[0];
            if (file) processPhoto(file);
        }

        function handlePhotoDrop(event) {
            event.preventDefault();
            event.target.classList.remove('dragover');
            const file = event.dataTransfer.files[0];
            if (file) processPhoto(file);
        }

        function processPhoto(file) {
            if (file.size > 1024 * 1024) {
                showToast('âš ï¸ Image trop grande (max 1 Mo)', 'warning');
                return;
            }

            if (!file.type.startsWith('image/')) {
                showToast('âš ï¸ Fichier non valide', 'warning');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                pendingPhoto = {
                    data: e.target.result,
                    name: file.name,
                    type: file.type
                };
                
                document.getElementById('photo-preview-img').src = e.target.result;
                document.getElementById('photo-preview').classList.add('active');
                showToast('âœ… Photo prÃªte', 'success');
            };
            reader.readAsDataURL(file);
        }

        function removePhoto() {
            pendingPhoto = { remove: true };
            document.getElementById('photo-preview').classList.remove('active');
            document.getElementById('photo-preview-img').src = '';
        }

        async function saveCandidat() {
            const nom = document.getElementById('edit-nom').value.trim();
            const role = document.getElementById('edit-role').value.trim();
            const delegation = document.getElementById('edit-delegation').value.trim();
            const bio = document.getElementById('edit-bio').value.trim();
            const pedigree = document.getElementById('edit-pedigree').value.trim();
            const objectifs = document.getElementById('edit-objectifs').value.trim();
            const citation = document.getElementById('edit-citation').value.trim();
            const email = document.getElementById('edit-email').value.trim();
            const facebook = document.getElementById('edit-facebook').value.trim();
            const linkedin = document.getElementById('edit-linkedin').value.trim();
            const twitter = document.getElementById('edit-twitter').value.trim();
            const ordre = parseInt(document.getElementById('edit-ordre').value) || 10;
            
            if (!nom) {
                showToast('âš ï¸ Nom obligatoire', 'warning');
                return;
            }

            let photo = currentEdit.index >= 0 ? data.candidats[currentEdit.index].photo : null;

            // Upload photo si nouvelle
            if (pendingPhoto && !pendingPhoto.remove) {
                showToast('â³ Upload de la photo...', 'info');
                const photoUrl = await uploadPhoto(pendingPhoto, nom);
                if (photoUrl) {
                    photo = photoUrl;
                }
            } else if (pendingPhoto && pendingPhoto.remove) {
                photo = null;
            }

            const candidatData = { 
                id: currentEdit.index >= 0 ? data.candidats[currentEdit.index].id : Date.now(),
                nom, role, delegation, bio, pedigree, objectifs, citation, email, facebook, linkedin, twitter, ordre, photo, actif: true 
            };

            if (currentEdit.index === -1) {
                data.candidats.push(candidatData);
            } else {
                data.candidats[currentEdit.index] = candidatData;
            }
            
            markModified('candidats');
            renderCandidats();
            closeModal();
            showToast('âœ… Candidat enregistrÃ©', 'success');
        }

        async function uploadPhoto(photoData, nom, retryCount = 0) {
            const token = getToken();
            if (!token) {
                showToast('âš ï¸ Token requis pour l\'upload', 'warning');
                return null;
            }

            // Nom de fichier propre
            const ext = photoData.name.split('.').pop().toLowerCase();
            const cleanName = nom.toLowerCase()
                .normalize('NFD').replace(/[\u0300-\u036f]/g, '') // Enlever accents
                .replace(/[^a-z0-9]/g, '-')
                .replace(/-+/g, '-');
            const filename = `images/${cleanName}.${ext}`;
            
            // Extraire le base64 pur (sans le prÃ©fixe data:image/...)
            const base64Content = photoData.data.split(',')[1];

            try {
                // RÃ©cupÃ©rer le SHA si le fichier existe
                let sha = null;
                const getResponse = await fetch(
                    `https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${filename}?ref=${GITHUB_CONFIG.branch}`,
                    { headers: { 'Authorization': `token ${token}` } }
                );
                if (getResponse.ok) {
                    sha = (await getResponse.json()).sha;
                }

                const body = {
                    message: `Upload photo ${nom}`,
                    content: base64Content,
                    branch: GITHUB_CONFIG.branch
                };
                if (sha) body.sha = sha;

                const response = await fetch(
                    `https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${filename}`,
                    {
                        method: 'PUT',
                        headers: {
                            'Authorization': `token ${token}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(body)
                    }
                );

                if (response.ok) {
                    showToast('âœ… Photo uploadÃ©e', 'success');
                    return filename;
                } else if (response.status === 409 && retryCount < 3) {
                    // Conflit - rÃ©essayer
                    showToast('ğŸ”„ Conflit, nouvelle tentative...', 'warning');
                    await new Promise(r => setTimeout(r, 1000));
                    return uploadPhoto(photoData, nom, retryCount + 1);
                } else {
                    const error = await response.json();
                    throw new Error(error.message || 'Upload failed');
                }
            } catch (err) {
                showToast('âŒ Erreur upload: ' + err.message, 'error');
                return null;
            }
        }

        function deleteCandidat(index) {
            if (confirm('Supprimer ce candidat ?')) {
                data.candidats.splice(index, 1);
                markModified('candidats');
                renderCandidats();
                showToast('ğŸ—‘ï¸ Candidat supprimÃ©', 'success');
            }
        }

        // ===== FAQ =====
        function renderFaq() {
            document.getElementById('faq-count').textContent = data.faq.length;
            document.getElementById('faq-list').innerHTML = data.faq.length === 0
                ? '<div class="empty-state"><div class="icon">â“</div><p>Aucune question</p></div>'
                : data.faq.map((f, i) => {
                    const origineIcons = {
                        'Site web': 'ğŸŒ',
                        'Facebook': 'ğŸ“˜',
                        'WhatsApp': 'ğŸ’¬',
                        'Permanence': 'ğŸ›ï¸',
                        'Email': 'ğŸ“§',
                        'Autre': 'ğŸ“'
                    };
                    const origineIcon = origineIcons[f.origine] || 'â“';
                    return `
                    <div class="item-card">
                        <div class="item-info">
                            <div class="item-text">
                                <div style="display: flex; gap: 0.5rem; flex-wrap: wrap; margin-bottom: 0.25rem;">
                                    ${f.categorie ? `<span class="item-badge">${f.categorie}</span>` : ''}
                                    ${f.origine ? `<span class="item-badge" style="background: #e8f4fc; color: var(--bleu);">${origineIcon} ${f.origine}</span>` : ''}
                                    ${f.pseudo ? `<span class="item-badge" style="background: #f0f0f0; color: #666;">ğŸ‘¤ ${f.pseudo}</span>` : ''}
                                </div>
                                <div class="item-title">${f.question}</div>
                                <div class="item-desc">${(f.reponse || '').substring(0, 100)}...</div>
                                ${f.date ? `<div class="item-desc" style="font-size: 0.8rem; opacity: 0.6;">ğŸ“… ${f.date}</div>` : ''}
                            </div>
                        </div>
                        <div class="item-actions">
                            <button class="btn btn-sm" style="background: #25D366; color: white;" onclick="copyForWhatsApp('faq', ${i})" title="Copier pour WhatsApp">ğŸ’¬</button>
                            <button class="btn btn-sm btn-primary" onclick="openEditFaq(${i})">âœï¸</button>
                            <button class="btn btn-sm btn-danger" onclick="deleteFaq(${i})">ğŸ—‘ï¸</button>
                        </div>
                    </div>
                `}).join('');
        }
        
        function copyForWhatsApp(type, index) {
            let text = '';
            
            if (type === 'faq') {
                const f = data.faq[index];
                text = `â“ *QUESTION D'UN VIZILLOIS*\n\n`;
                if (f.pseudo) text += `ğŸ‘¤ _${f.pseudo}_\n`;
                if (f.categorie) text += `ğŸ·ï¸ ${f.categorie}\n`;
                text += `\nğŸ“ *${f.question}*\n\n`;
                text += `âœ… *Notre rÃ©ponse :*\n${f.reponse}\n\n`;
                text += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n`;
                text += `ğŸ—³ï¸ *Vizille en Mouvement*\n`;
                text += `ğŸŒ https://Vizilleenmouvement.github.io/Vizille-en-mouvement/`;
            } 
            else if (type === 'article') {
                const a = data.articles[index];
                text = `ğŸ“° *${a.titre}*\n\n`;
                if (a.date) text += `ğŸ“… ${a.date}\n\n`;
                text += `${a.resume || a.contenu?.substring(0, 200) || ''}\n\n`;
                text += `ğŸ‘‰ Lire la suite sur notre site\n`;
                text += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n`;
                text += `ğŸ—³ï¸ *Vizille en Mouvement*\n`;
                text += `ğŸŒ https://Vizilleenmouvement.github.io/Vizille-en-mouvement/blog.html`;
            }
            
            navigator.clipboard.writeText(text).then(() => {
                showToast('âœ… CopiÃ© ! Collez dans WhatsApp', 'success');
            }).catch(() => {
                // Fallback
                const textarea = document.createElement('textarea');
                textarea.value = text;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                showToast('âœ… CopiÃ© ! Collez dans WhatsApp', 'success');
            });
        }

        function openAddFaq() {
            currentEdit = { type: 'faq', index: -1 };
            showFaqModal({});
        }

        function openEditFaq(index) {
            currentEdit = { type: 'faq', index };
            showFaqModal(data.faq[index]);
        }

        function showFaqModal(f) {
            document.getElementById('modal-title').textContent = currentEdit.index === -1 ? 'â• Ajouter une question' : 'âœï¸ Modifier la question';
            document.getElementById('modal-body').innerHTML = `
                <div class="form-row">
                    <div class="form-group">
                        <label>ğŸ“ Origine *</label>
                        <select id="edit-origine">
                            <option value="">-- Source --</option>
                            <option value="Site web" ${f.origine === 'Site web' ? 'selected' : ''}>ğŸŒ Site web</option>
                            <option value="Facebook" ${f.origine === 'Facebook' ? 'selected' : ''}>ğŸ“˜ Facebook</option>
                            <option value="WhatsApp" ${f.origine === 'WhatsApp' ? 'selected' : ''}>ğŸ’¬ WhatsApp</option>
                            <option value="Permanence" ${f.origine === 'Permanence' ? 'selected' : ''}>ğŸ›ï¸ Permanence</option>
                            <option value="Email" ${f.origine === 'Email' ? 'selected' : ''}>ğŸ“§ Email</option>
                            <option value="Autre" ${f.origine === 'Autre' ? 'selected' : ''}>ğŸ“ Autre</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ğŸ‘¤ Pseudo / Nom</label>
                        <input type="text" id="edit-pseudo" value="${f.pseudo || ''}" placeholder="Ex: Marie D., Anonyme...">
                    </div>
                    <div class="form-group">
                        <label>ğŸ“… Date</label>
                        <input type="date" id="edit-date" value="${f.date || ''}">
                    </div>
                </div>
                <div class="form-group">
                    <label>Question *</label>
                    <input type="text" id="edit-question" value="${f.question || ''}">
                </div>
                <div class="form-group">
                    <label>RÃ©ponse *</label>
                    <textarea id="edit-reponse" rows="5">${f.reponse || ''}</textarea>
                </div>
                <div class="form-group">
                    <label>CatÃ©gorie / ThÃ¨me</label>
                    <input type="text" id="edit-categorie" value="${f.categorie || ''}" placeholder="Ex: Urbanisme, TranquillitÃ©, Vie municipale...">
                </div>
            `;
            document.getElementById('modal-save').onclick = saveFaq;
            document.getElementById('modal-edit').classList.add('active');
        }

        function saveFaq() {
            const question = document.getElementById('edit-question').value.trim();
            const reponse = document.getElementById('edit-reponse').value.trim();
            const categorie = document.getElementById('edit-categorie').value.trim();
            const origine = document.getElementById('edit-origine').value;
            const pseudo = document.getElementById('edit-pseudo').value.trim();
            const date = document.getElementById('edit-date').value;
            
            if (!question || !reponse) {
                showToast('âš ï¸ Question et rÃ©ponse obligatoires', 'warning');
                return;
            }

            if (currentEdit.index === -1) {
                data.faq.push({ id: Date.now(), question, reponse, categorie, origine, pseudo, date });
            } else {
                Object.assign(data.faq[currentEdit.index], { question, reponse, categorie, origine, pseudo, date });
            }
            
            markModified('faq');
            renderFaq();
            closeModal();
            showToast('âœ… Question enregistrÃ©e', 'success');
        }

        function deleteFaq(index) {
            if (confirm('Supprimer cette question ?')) {
                data.faq.splice(index, 1);
                markModified('faq');
                renderFaq();
                showToast('ğŸ—‘ï¸ Question supprimÃ©e', 'success');
            }
        }

        // ===== ARTICLES =====
        function renderArticles() {
            document.getElementById('articles-count').textContent = data.articles.length;
            const sorted = [...data.articles].sort((a, b) => new Date(b.date || 0) - new Date(a.date || 0));
            
            document.getElementById('articles-list').innerHTML = sorted.length === 0
                ? '<div class="empty-state"><div class="icon">ğŸ“°</div><p>Aucun article</p></div>'
                : sorted.map((a, i) => {
                    const realIndex = data.articles.indexOf(a);
                    const categorieBadge = a.categorie ? `<span style="background: #e8f4fc; color: var(--bleu); padding: 2px 8px; border-radius: 4px; font-size: 0.75rem; margin-left: 8px;">${a.categorie}</span>` : '';
                    const imageIndicator = a.image ? 'ğŸ–¼ï¸' : '';
                    return `
                        <div class="item-card">
                            <div class="item-info">
                                ${a.image ? `<img src="${a.image}" alt="" class="item-photo" style="border-radius: 8px; width: 60px; height: 60px; object-fit: cover;">` : '<div class="item-photo-placeholder">ğŸ“°</div>'}
                                <div class="item-text">
                                    <span class="item-badge">${a.date || 'Sans date'}${categorieBadge}</span>
                                    <div class="item-title">${a.titre} ${imageIndicator}</div>
                                    <div class="item-desc">${a.extrait || a.contenu?.substring(0, 100) || ''}</div>
                                </div>
                            </div>
                            <div class="item-actions">
                                <button class="btn btn-sm" style="background: #25D366; color: white;" onclick="copyForWhatsApp('article', ${realIndex})" title="Copier pour WhatsApp">ğŸ’¬</button>
                                <button class="btn btn-sm btn-primary" onclick="openEditArticle(${realIndex})">âœï¸</button>
                                <button class="btn btn-sm btn-danger" onclick="deleteArticle(${realIndex})">ğŸ—‘ï¸</button>
                            </div>
                        </div>
                    `;
                }).join('');
            
            // Mettre Ã  jour la liste pour le partage Facebook
            updateFacebookArticleSelect();
        }

        function openAddArticle() {
            currentEdit = { type: 'article', index: -1 };
            showArticleModal({ date: new Date().toISOString().split('T')[0] });
        }

        function openEditArticle(index) {
            currentEdit = { type: 'article', index };
            showArticleModal(data.articles[index]);
        }

        function showArticleModal(a) {
            document.getElementById('modal-title').textContent = currentEdit.index === -1 ? 'â• Ajouter un article' : 'âœï¸ Modifier l\'article';
            document.getElementById('modal-body').innerHTML = `
                <div class="form-row">
                    <div class="form-group">
                        <label>Titre *</label>
                        <input type="text" id="edit-titre" value="${a.titre || ''}">
                    </div>
                    <div class="form-group">
                        <label>Date</label>
                        <input type="date" id="edit-date" value="${a.date || ''}">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>CatÃ©gorie</label>
                        <select id="edit-categorie">
                            <option value="">-- Sans catÃ©gorie --</option>
                            <option value="Ã‰vÃ©nement" ${a.categorie === 'Ã‰vÃ©nement' ? 'selected' : ''}>ğŸ“… Ã‰vÃ©nement</option>
                            <option value="CommuniquÃ©" ${a.categorie === 'CommuniquÃ©' ? 'selected' : ''}>ğŸ“£ CommuniquÃ©</option>
                            <option value="RÃ©union" ${a.categorie === 'RÃ©union' ? 'selected' : ''}>ğŸ¤ RÃ©union</option>
                            <option value="Action" ${a.categorie === 'Action' ? 'selected' : ''}>âœŠ Action</option>
                            <option value="Bilan" ${a.categorie === 'Bilan' ? 'selected' : ''}>ğŸ“Š Bilan</option>
                            <option value="Projet" ${a.categorie === 'Projet' ? 'selected' : ''}>ğŸš€ Projet</option>
                            <option value="Tribune" ${a.categorie === 'Tribune' ? 'selected' : ''}>ğŸ“ Tribune</option>
                            <option value="Info" ${a.categorie === 'Info' ? 'selected' : ''}>â„¹ï¸ Info</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Image (URL)</label>
                        <input type="url" id="edit-image" value="${a.image || ''}" placeholder="https://... ou images/nom.jpg">
                    </div>
                </div>
                <div class="form-group">
                    <label>Extrait (aperÃ§u court)</label>
                    <textarea id="edit-extrait" rows="2" placeholder="Court rÃ©sumÃ© affichÃ© dans la liste des actualitÃ©s...">${a.extrait || ''}</textarea>
                </div>
                <div class="form-group">
                    <label>Contenu complet</label>
                    <textarea id="edit-contenu" rows="8" placeholder="Le texte complet de l'article. Utilisez des sauts de ligne pour sÃ©parer les paragraphes.">${a.contenu || ''}</textarea>
                </div>
                <div id="image-preview" style="margin-top: 1rem; display: ${a.image ? 'block' : 'none'};">
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 500; color: var(--bleu);">AperÃ§u image :</label>
                    <img src="${a.image || ''}" alt="AperÃ§u" style="max-width: 200px; max-height: 150px; border-radius: 8px; border: 2px solid var(--gris-border);" onerror="this.parentElement.style.display='none'">
                </div>
            `;
            
            // PrÃ©visualiser l'image quand l'URL change
            document.getElementById('edit-image').addEventListener('input', function() {
                const preview = document.getElementById('image-preview');
                const img = preview.querySelector('img');
                if (this.value) {
                    img.src = this.value;
                    preview.style.display = 'block';
                } else {
                    preview.style.display = 'none';
                }
            });
            
            document.getElementById('modal-save').onclick = saveArticle;
            document.getElementById('modal-edit').classList.add('active');
        }

        function saveArticle() {
            const titre = document.getElementById('edit-titre').value.trim();
            const date = document.getElementById('edit-date').value;
            const categorie = document.getElementById('edit-categorie').value;
            const image = document.getElementById('edit-image').value.trim();
            const extrait = document.getElementById('edit-extrait').value.trim();
            const contenu = document.getElementById('edit-contenu').value.trim();
            
            if (!titre) {
                showToast('âš ï¸ Titre obligatoire', 'warning');
                return;
            }

            const articleData = { 
                id: currentEdit.index === -1 ? Date.now() : data.articles[currentEdit.index].id,
                titre, 
                date, 
                categorie,
                image,
                extrait, 
                contenu 
            };

            if (currentEdit.index === -1) {
                data.articles.push(articleData);
            } else {
                data.articles[currentEdit.index] = articleData;
            }
            
            markModified('articles');
            renderArticles();
            updateFacebookArticleSelect();
            closeModal();
            showToast('âœ… Article enregistrÃ©', 'success');
        }

        function deleteArticle(index) {
            if (confirm('Supprimer cet article ?')) {
                data.articles.splice(index, 1);
                markModified('articles');
                renderArticles();
                showToast('ğŸ—‘ï¸ Article supprimÃ©', 'success');
            }
        }

        // ===== ABONNÃ‰S NEWSLETTER =====
        function renderAbonnes() {
            const search = (document.getElementById('search-abonnes')?.value || '').toLowerCase();
            const abonnesActifs = data.abonnes.filter(a => a.actif !== false);
            
            const filtered = data.abonnes.filter(a => {
                if (!search) return true;
                return (a.email || '').toLowerCase().includes(search) || 
                       (a.nom || '').toLowerCase().includes(search);
            });
            
            document.getElementById('abonnes-count').textContent = filtered.length;
            document.getElementById('stats-abonnes').textContent = `${abonnesActifs.length} abonnÃ©s actifs`;
            
            const container = document.getElementById('abonnes-list');
            if (filtered.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">ğŸ“§</div>
                        <p>Aucun abonnÃ©${search ? ' trouvÃ©' : ''}</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = filtered.map((a, i) => {
                const realIndex = data.abonnes.indexOf(a);
                const statusClass = a.actif === false ? 'style="opacity: 0.5;"' : '';
                const statusBadge = a.actif === false ? 
                    '<span style="background: #fee; color: #c00; padding: 2px 8px; border-radius: 4px; font-size: 0.75rem; margin-left: 8px;">DÃ©sabonnÃ©</span>' : '';
                return `
                    <div class="item-card" ${statusClass}>
                        <div class="item-info">
                            <div class="item-photo-placeholder">ğŸ“§</div>
                            <div class="item-text">
                                <div class="item-title">${a.email}${statusBadge}</div>
                                <div class="item-desc">${a.nom || 'Sans nom'} â€¢ Inscrit le ${a.date || 'N/A'}</div>
                            </div>
                        </div>
                        <div class="item-actions">
                            <button class="btn btn-sm btn-primary" onclick="openEditAbonne(${realIndex})">âœï¸</button>
                            <button class="btn btn-sm btn-danger" onclick="deleteAbonne(${realIndex})">ğŸ—‘ï¸</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function openAddAbonne() {
            currentEdit = { type: 'abonne', index: -1 };
            showAbonneModal({ date: new Date().toISOString().split('T')[0], actif: true });
        }

        function openEditAbonne(index) {
            currentEdit = { type: 'abonne', index };
            showAbonneModal(data.abonnes[index]);
        }

        function showAbonneModal(a) {
            document.getElementById('modal-title').textContent = currentEdit.index === -1 ? 'â• Ajouter un abonnÃ©' : 'âœï¸ Modifier l\'abonnÃ©';
            document.getElementById('modal-body').innerHTML = `
                <div class="form-group">
                    <label>Email *</label>
                    <input type="email" id="edit-abonne-email" value="${a.email || ''}">
                </div>
                <div class="form-group">
                    <label>Nom (optionnel)</label>
                    <input type="text" id="edit-abonne-nom" value="${a.nom || ''}">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Date d'inscription</label>
                        <input type="date" id="edit-abonne-date" value="${a.date || ''}">
                    </div>
                    <div class="form-group">
                        <label>Statut</label>
                        <select id="edit-abonne-actif">
                            <option value="true" ${a.actif !== false ? 'selected' : ''}>âœ… Actif</option>
                            <option value="false" ${a.actif === false ? 'selected' : ''}>âŒ DÃ©sabonnÃ©</option>
                        </select>
                    </div>
                </div>
            `;
            document.getElementById('modal-save').onclick = saveAbonne;
            document.getElementById('modal-edit').classList.add('active');
        }

        function saveAbonne() {
            const email = document.getElementById('edit-abonne-email').value.trim();
            const nom = document.getElementById('edit-abonne-nom').value.trim();
            const date = document.getElementById('edit-abonne-date').value;
            const actif = document.getElementById('edit-abonne-actif').value === 'true';
            
            if (!email || !email.includes('@')) {
                showToast('âš ï¸ Email invalide', 'warning');
                return;
            }

            // VÃ©rifier si l'email existe dÃ©jÃ  (sauf en Ã©dition du mÃªme)
            const existant = data.abonnes.findIndex(a => a.email.toLowerCase() === email.toLowerCase());
            if (existant !== -1 && existant !== currentEdit.index) {
                showToast('âš ï¸ Cet email existe dÃ©jÃ ', 'warning');
                return;
            }

            if (currentEdit.index === -1) {
                data.abonnes.push({ id: Date.now(), email, nom, date, actif });
            } else {
                Object.assign(data.abonnes[currentEdit.index], { email, nom, date, actif });
            }
            
            markModified('abonnes');
            renderAbonnes();
            closeModal();
            showToast('âœ… AbonnÃ© enregistrÃ©', 'success');
        }

        function deleteAbonne(index) {
            if (confirm('Supprimer cet abonnÃ© ?')) {
                data.abonnes.splice(index, 1);
                markModified('abonnes');
                renderAbonnes();
                showToast('ğŸ—‘ï¸ AbonnÃ© supprimÃ©', 'success');
            }
        }

        function exportAbonnes() {
            const actifs = data.abonnes.filter(a => a.actif !== false);
            const csv = 'Email,Nom,Date\n' + actifs.map(a => `${a.email},"${a.nom || ''}",${a.date || ''}`).join('\n');
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `abonnes-vizille-${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            URL.revokeObjectURL(url);
            showToast('ğŸ“¥ Export CSV tÃ©lÃ©chargÃ©', 'success');
        }

        function importAbonnes(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const text = e.target.result;
                const lines = text.split('\n').filter(l => l.trim());
                let count = 0;
                
                lines.forEach((line, i) => {
                    if (i === 0 && line.toLowerCase().includes('email')) return; // Skip header
                    
                    const parts = line.split(',');
                    const email = parts[0]?.trim().replace(/"/g, '');
                    
                    if (email && email.includes('@')) {
                        const existe = data.abonnes.find(a => a.email.toLowerCase() === email.toLowerCase());
                        if (!existe) {
                            data.abonnes.push({
                                id: Date.now() + count,
                                email,
                                nom: parts[1]?.trim().replace(/"/g, '') || '',
                                date: new Date().toISOString().split('T')[0],
                                actif: true
                            });
                            count++;
                        }
                    }
                });
                
                if (count > 0) {
                    markModified('abonnes');
                    renderAbonnes();
                    showToast(`âœ… ${count} abonnÃ©s importÃ©s`, 'success');
                } else {
                    showToast('âš ï¸ Aucun nouvel email trouvÃ©', 'warning');
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        // ===== PARTAGE FACEBOOK =====
        function updateFacebookArticleSelect() {
            renderFacebookSelect();
        }
        
        function renderFacebookSelect() {
            const select = document.getElementById('fb-article-select');
            if (!select) return;
            
            select.innerHTML = '<option value="">-- SÃ©lectionnez un article --</option>' +
                data.articles.map((a, i) => `<option value="${i}">${a.date || 'Sans date'} - ${a.titre}</option>`).join('');
        }

        function previewFacebookPost() {
            const select = document.getElementById('fb-article-select');
            const index = select.value;
            const previewZone = document.getElementById('fb-preview-zone');
            
            if (index === '') {
                previewZone.style.display = 'none';
                return;
            }
            
            const article = data.articles[index];
            const siteUrl = `https://Vizilleenmouvement.github.io/Vizille-en-mouvement/blog.html`;
            
            const postText = `ğŸ“° ${article.titre}

${article.extrait || article.resume || article.contenu?.substring(0, 200) + '...' || ''}

ğŸ‘‰ Lire l'article complet sur notre site :
${siteUrl}

#Vizille #Municipales2026 #VizilleEnMouvement`;
            
            document.getElementById('fb-post-text').value = postText;
            previewZone.style.display = 'block';
        }

        function copyFacebookPost() {
            const text = document.getElementById('fb-post-text').value;
            navigator.clipboard.writeText(text).then(() => {
                showToast('ğŸ“‹ Texte copiÃ© ! Collez-le sur Facebook', 'success');
            }).catch(() => {
                showToast('âŒ Erreur de copie', 'error');
            });
        }

        // ===== NEWSLETTER =====
        function initNewsletterDate() {
            const dateInput = document.getElementById('nl-date');
            if (dateInput && !dateInput.value) {
                dateInput.value = new Date().toISOString().split('T')[0];
            }
        }

        function generateNewsletter() {
            const objet = document.getElementById('nl-objet').value.trim();
            const date = document.getElementById('nl-date').value;
            const intro = document.getElementById('nl-intro').value.trim();
            const contenu = document.getElementById('nl-contenu').value.trim();
            const cta = document.getElementById('nl-cta').value.trim();
            
            if (!objet || !contenu) {
                showToast('âš ï¸ Objet et contenu requis', 'warning');
                return;
            }
            
            const dateFormatted = date ? new Date(date).toLocaleDateString('fr-FR', { 
                weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' 
            }) : '';
            
            let newsletter = `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ›ï¸ VIZILLE EN MOUVEMENT
Vos questions pour une ville dynamique et solidaire
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“… ${dateFormatted}

`;
            
            if (intro) {
                newsletter += `${intro}\n\n`;
            }
            
            newsletter += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“° ACTUALITÃ‰S
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

${contenu}

`;
            
            if (cta) {
                newsletter += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“¢ Ã€ NE PAS MANQUER
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

${cta}

`;
            }
            
            newsletter += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“± SUIVEZ-NOUS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸŒ Site : https://Vizilleenmouvement.github.io/Vizille-en-mouvement/
ğŸ“˜ Facebook : ${data.config.facebook || 'https://facebook.com/Vizilleenmouvement'}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Pour vous dÃ©sabonner, rÃ©pondez Ã  cet email.
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”`;
            
            document.getElementById('nl-output').value = newsletter;
            document.getElementById('nl-result').style.display = 'block';
            showToast('âœ¨ Newsletter gÃ©nÃ©rÃ©e !', 'success');
        }

        function clearNewsletter() {
            document.getElementById('nl-objet').value = '';
            document.getElementById('nl-intro').value = '';
            document.getElementById('nl-contenu').value = '';
            document.getElementById('nl-cta').value = '';
            document.getElementById('nl-output').value = '';
            document.getElementById('nl-result').style.display = 'none';
            showToast('ğŸ—‘ï¸ Formulaire effacÃ©', 'info');
        }

        function copyNewsletter() {
            const text = document.getElementById('nl-output').value;
            navigator.clipboard.writeText(text).then(() => {
                showToast('ğŸ“‹ Newsletter copiÃ©e !', 'success');
            }).catch(() => {
                showToast('âŒ Erreur de copie', 'error');
            });
        }

        function copyAbonnesEmails() {
            const actifs = data.abonnes.filter(a => a.actif !== false);
            const emails = actifs.map(a => a.email).join('; ');
            
            if (!emails) {
                showToast('âš ï¸ Aucun abonnÃ© actif', 'warning');
                return;
            }
            
            navigator.clipboard.writeText(emails).then(() => {
                showToast(`ğŸ“§ ${actifs.length} emails copiÃ©s !`, 'success');
            }).catch(() => {
                showToast('âŒ Erreur de copie', 'error');
            });
        }

        // ===== CONFIG =====
        function renderConfig() {
            document.getElementById('config-email').value = data.config.email || '';
            document.getElementById('config-telephone').value = data.config.telephone || '';
            document.getElementById('config-adresse').value = data.config.adresse || '';
            document.getElementById('config-facebook').value = data.config.facebook || '';
            document.getElementById('config-instagram').value = data.config.instagram || '';
            document.getElementById('config-twitter').value = data.config.twitter || '';
            document.getElementById('config-autre').value = data.config.autre || '';
            document.getElementById('config-permanences').value = data.config.permanences || '';
            document.getElementById('config-slogan').value = data.config.slogan || 'Vos questions pour une ville dynamique et solidaire';
        }

        // ===== PUBLICATION =====
        // Flag pour Ã©viter les publications multiples simultanÃ©es
        const publishingInProgress = {};
        
        async function publish(section, retryCount = 0) {
            // Ã‰viter les clics multiples
            if (publishingInProgress[section]) {
                showToast('â³ Publication dÃ©jÃ  en cours...', 'info');
                return;
            }
            
            const token = getToken();
            if (!token) {
                showToast('âš ï¸ Configurez votre token GitHub', 'warning');
                return;
            }

            const files = {
                projets: 'projets.json',
                themes: 'themes.json',
                actions: 'data.json',
                candidats: 'candidats.json',
                faq: 'faq.json',
                articles: 'articles.json',
                abonnes: 'abonnes.json',
                config: 'config.json'
            };

            const filename = files[section];
            publishingInProgress[section] = true;
            
            // Pour themes, synchroniser avec THEMES_CONFIG
            if (section === 'themes') {
                data.themes = [...THEMES_CONFIG];
            }
            
            // Pour config, on doit d'abord lire les valeurs des champs
            if (section === 'config') {
                data.config = {
                    email: document.getElementById('config-email').value,
                    telephone: document.getElementById('config-telephone').value,
                    adresse: document.getElementById('config-adresse').value,
                    facebook: document.getElementById('config-facebook').value,
                    instagram: document.getElementById('config-instagram').value,
                    twitter: document.getElementById('config-twitter').value,
                    autre: document.getElementById('config-autre').value,
                    permanences: document.getElementById('config-permanences').value,
                    slogan: document.getElementById('config-slogan').value
                };
            }
            
            // Pour candidats, nettoyer les chemins de photos locaux
            if (section === 'candidats') {
                data.candidats = data.candidats.map(c => ({
                    ...c,
                    photo: c.photo && c.photo.startsWith('file://') ? '' : c.photo
                }));
            }
            
            const content = JSON.stringify(data[section], null, 2);

            setStatus(section, 'loading', 'â³ Publication...');

            try {
                // RÃ©cupÃ©rer le SHA actuel (avec cache-buster pour Ã©viter le cache)
                let sha = null;
                const timestamp = Date.now();
                const getResponse = await fetch(
                    `https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${filename}?ref=${GITHUB_CONFIG.branch}&_=${timestamp}`,
                    { 
                        headers: { 
                            'Authorization': `token ${token}`
                        } 
                    }
                );
                if (getResponse.ok) {
                    const fileData = await getResponse.json();
                    sha = fileData.sha;
                    console.log(`ğŸ“„ SHA rÃ©cupÃ©rÃ© pour ${filename}: ${sha.substring(0, 7)}...`);
                }

                const body = {
                    message: `Mise Ã  jour ${filename} via Admin`,
                    content: btoa(unescape(encodeURIComponent(content))),
                    branch: GITHUB_CONFIG.branch
                };
                if (sha) body.sha = sha;

                const response = await fetch(
                    `https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${filename}`,
                    {
                        method: 'PUT',
                        headers: {
                            'Authorization': `token ${token}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(body)
                    }
                );

                if (response.ok) {
                    setStatus(section, 'saved', 'âœ“ Ã€ jour');
                    showToast(`âœ… ${filename} publiÃ© !`, 'success');
                    publishingInProgress[section] = false;
                } else if (response.status === 409 && retryCount < 5) {
                    // Conflit - attendre un peu plus longtemps et rÃ©essayer
                    const delay = 1000 * (retryCount + 1); // 1s, 2s, 3s, 4s, 5s
                    console.log(`ğŸ”„ Conflit 409 sur ${filename}, retry ${retryCount + 1}/5 dans ${delay}ms...`);
                    showToast(`ğŸ”„ Conflit, nouvelle tentative (${retryCount + 1}/5)...`, 'warning');
                    await new Promise(r => setTimeout(r, delay));
                    publishingInProgress[section] = false;
                    return publish(section, retryCount + 1);
                } else {
                    const error = await response.json();
                    throw new Error(error.message || `Erreur ${response.status}`);
                }
            } catch (err) {
                setStatus(section, 'modified', 'âš ï¸ Erreur');
                publishingInProgress[section] = false;
                showToast('âŒ Erreur: ' + err.message, 'error');
            }
        }

        // ===== MODAL =====
        function closeModal() {
            document.getElementById('modal-edit').classList.remove('active');
            pendingPhoto = null;
        }

        // Fermer modal avec Escape
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeModal();
        });

        // ===== TOAST =====
        function showToast(message, type) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = 'toast show ' + type;
            setTimeout(() => toast.className = 'toast', 3000);
        }
    </script>

</body>
</html>
